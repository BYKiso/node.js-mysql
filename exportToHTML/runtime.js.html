<html>
<head>
<title>runtime.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6aab73;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #7a7e85;}
.s5 { color: #2aacb8;}
.s6 { color: #5f826b; font-style: italic;}
.ln { color: #4b5059; font-weight: normal; font-style: normal; }
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
runtime.js</font>
</center></td></tr></table>
<pre><a name="l1"><span class="ln">1    </span></a><span class="s0">'use strict'</span><span class="s1">;</span>
<a name="l2"><span class="ln">2    </span></a>
<a name="l3"><span class="ln">3    </span></a><span class="s2">exports</span><span class="s1">.</span><span class="s2">__esModule </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
<a name="l4"><span class="ln">4    </span></a><span class="s2">exports</span><span class="s1">.</span><span class="s2">checkRevision </span><span class="s1">= </span><span class="s2">checkRevision</span><span class="s1">;</span>
<a name="l5"><span class="ln">5    </span></a><span class="s2">exports</span><span class="s1">.</span><span class="s2">template </span><span class="s1">= </span><span class="s2">template</span><span class="s1">;</span>
<a name="l6"><span class="ln">6    </span></a><span class="s2">exports</span><span class="s1">.</span><span class="s2">wrapProgram </span><span class="s1">= </span><span class="s2">wrapProgram</span><span class="s1">;</span>
<a name="l7"><span class="ln">7    </span></a><span class="s2">exports</span><span class="s1">.</span><span class="s2">resolvePartial </span><span class="s1">= </span><span class="s2">resolvePartial</span><span class="s1">;</span>
<a name="l8"><span class="ln">8    </span></a><span class="s2">exports</span><span class="s1">.</span><span class="s2">invokePartial </span><span class="s1">= </span><span class="s2">invokePartial</span><span class="s1">;</span>
<a name="l9"><span class="ln">9    </span></a><span class="s2">exports</span><span class="s1">.</span><span class="s2">noop </span><span class="s1">= </span><span class="s2">noop</span><span class="s1">;</span>
<a name="l10"><span class="ln">10   </span></a><span class="s4">// istanbul ignore next</span>
<a name="l11"><span class="ln">11   </span></a>
<a name="l12"><span class="ln">12   </span></a><span class="s3">function </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">) { </span><span class="s3">return </span><span class="s2">obj </span><span class="s1">&amp;&amp; </span><span class="s2">obj</span><span class="s1">.</span><span class="s2">__esModule </span><span class="s1">? </span><span class="s2">obj </span><span class="s1">: { </span><span class="s0">'default'</span><span class="s1">: </span><span class="s2">obj </span><span class="s1">}; }</span>
<a name="l13"><span class="ln">13   </span></a>
<a name="l14"><span class="ln">14   </span></a><span class="s4">// istanbul ignore next</span>
<a name="l15"><span class="ln">15   </span></a>
<a name="l16"><span class="ln">16   </span></a><span class="s3">function </span><span class="s2">_interopRequireWildcard</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">) { </span><span class="s3">if </span><span class="s1">(</span><span class="s2">obj </span><span class="s1">&amp;&amp; </span><span class="s2">obj</span><span class="s1">.</span><span class="s2">__esModule</span><span class="s1">) { </span><span class="s3">return </span><span class="s2">obj</span><span class="s1">; } </span><span class="s3">else </span><span class="s1">{ </span><span class="s3">var </span><span class="s2">newObj </span><span class="s1">= {}; </span><span class="s3">if </span><span class="s1">(</span><span class="s2">obj </span><span class="s1">!= </span><span class="s3">null</span><span class="s1">) { </span><span class="s3">for </span><span class="s1">(</span><span class="s3">var </span><span class="s2">key </span><span class="s3">in </span><span class="s2">obj</span><span class="s1">) { </span><span class="s3">if </span><span class="s1">(</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">hasOwnProperty</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s2">key</span><span class="s1">)) </span><span class="s2">newObj</span><span class="s1">[</span><span class="s2">key</span><span class="s1">] = </span><span class="s2">obj</span><span class="s1">[</span><span class="s2">key</span><span class="s1">]; } } </span><span class="s2">newObj</span><span class="s1">[</span><span class="s0">'default'</span><span class="s1">] = </span><span class="s2">obj</span><span class="s1">; </span><span class="s3">return </span><span class="s2">newObj</span><span class="s1">; } }</span>
<a name="l17"><span class="ln">17   </span></a>
<a name="l18"><span class="ln">18   </span></a><span class="s3">var </span><span class="s2">_utils </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./utils'</span><span class="s1">);</span>
<a name="l19"><span class="ln">19   </span></a>
<a name="l20"><span class="ln">20   </span></a><span class="s3">var </span><span class="s2">Utils </span><span class="s1">= </span><span class="s2">_interopRequireWildcard</span><span class="s1">(</span><span class="s2">_utils</span><span class="s1">);</span>
<a name="l21"><span class="ln">21   </span></a>
<a name="l22"><span class="ln">22   </span></a><span class="s3">var </span><span class="s2">_exception </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./exception'</span><span class="s1">);</span>
<a name="l23"><span class="ln">23   </span></a>
<a name="l24"><span class="ln">24   </span></a><span class="s3">var </span><span class="s2">_exception2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_exception</span><span class="s1">);</span>
<a name="l25"><span class="ln">25   </span></a>
<a name="l26"><span class="ln">26   </span></a><span class="s3">var </span><span class="s2">_base </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./base'</span><span class="s1">);</span>
<a name="l27"><span class="ln">27   </span></a>
<a name="l28"><span class="ln">28   </span></a><span class="s3">var </span><span class="s2">_helpers </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./helpers'</span><span class="s1">);</span>
<a name="l29"><span class="ln">29   </span></a>
<a name="l30"><span class="ln">30   </span></a><span class="s3">var </span><span class="s2">_internalWrapHelper </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./internal/wrapHelper'</span><span class="s1">);</span>
<a name="l31"><span class="ln">31   </span></a>
<a name="l32"><span class="ln">32   </span></a><span class="s3">var </span><span class="s2">_internalProtoAccess </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./internal/proto-access'</span><span class="s1">);</span>
<a name="l33"><span class="ln">33   </span></a>
<a name="l34"><span class="ln">34   </span></a><span class="s3">function </span><span class="s2">checkRevision</span><span class="s1">(</span><span class="s2">compilerInfo</span><span class="s1">) {</span>
<a name="l35"><span class="ln">35   </span></a>  <span class="s3">var </span><span class="s2">compilerRevision </span><span class="s1">= </span><span class="s2">compilerInfo </span><span class="s1">&amp;&amp; </span><span class="s2">compilerInfo</span><span class="s1">[</span><span class="s5">0</span><span class="s1">] || </span><span class="s5">1</span><span class="s1">,</span>
<a name="l36"><span class="ln">36   </span></a>      <span class="s2">currentRevision </span><span class="s1">= </span><span class="s2">_base</span><span class="s1">.</span><span class="s2">COMPILER_REVISION</span><span class="s1">;</span>
<a name="l37"><span class="ln">37   </span></a>
<a name="l38"><span class="ln">38   </span></a>  <span class="s3">if </span><span class="s1">(</span><span class="s2">compilerRevision </span><span class="s1">&gt;= </span><span class="s2">_base</span><span class="s1">.</span><span class="s2">LAST_COMPATIBLE_COMPILER_REVISION </span><span class="s1">&amp;&amp; </span><span class="s2">compilerRevision </span><span class="s1">&lt;= </span><span class="s2">_base</span><span class="s1">.</span><span class="s2">COMPILER_REVISION</span><span class="s1">) {</span>
<a name="l39"><span class="ln">39   </span></a>    <span class="s3">return</span><span class="s1">;</span>
<a name="l40"><span class="ln">40   </span></a>  <span class="s1">}</span>
<a name="l41"><span class="ln">41   </span></a>
<a name="l42"><span class="ln">42   </span></a>  <span class="s3">if </span><span class="s1">(</span><span class="s2">compilerRevision </span><span class="s1">&lt; </span><span class="s2">_base</span><span class="s1">.</span><span class="s2">LAST_COMPATIBLE_COMPILER_REVISION</span><span class="s1">) {</span>
<a name="l43"><span class="ln">43   </span></a>    <span class="s3">var </span><span class="s2">runtimeVersions </span><span class="s1">= </span><span class="s2">_base</span><span class="s1">.</span><span class="s2">REVISION_CHANGES</span><span class="s1">[</span><span class="s2">currentRevision</span><span class="s1">],</span>
<a name="l44"><span class="ln">44   </span></a>        <span class="s2">compilerVersions </span><span class="s1">= </span><span class="s2">_base</span><span class="s1">.</span><span class="s2">REVISION_CHANGES</span><span class="s1">[</span><span class="s2">compilerRevision</span><span class="s1">];</span>
<a name="l45"><span class="ln">45   </span></a>    <span class="s3">throw new </span><span class="s2">_exception2</span><span class="s1">[</span><span class="s0">'default'</span><span class="s1">](</span><span class="s0">'Template was precompiled with an older version of Handlebars than the current runtime. ' </span><span class="s1">+ </span><span class="s0">'Please update your precompiler to a newer version (' </span><span class="s1">+ </span><span class="s2">runtimeVersions </span><span class="s1">+ </span><span class="s0">') or downgrade your runtime to an older version (' </span><span class="s1">+ </span><span class="s2">compilerVersions </span><span class="s1">+ </span><span class="s0">').'</span><span class="s1">);</span>
<a name="l46"><span class="ln">46   </span></a>  <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
<a name="l47"><span class="ln">47   </span></a>    <span class="s4">// Use the embedded version info since the runtime doesn't know about this revision yet</span>
<a name="l48"><span class="ln">48   </span></a>    <span class="s3">throw new </span><span class="s2">_exception2</span><span class="s1">[</span><span class="s0">'default'</span><span class="s1">](</span><span class="s0">'Template was precompiled with a newer version of Handlebars than the current runtime. ' </span><span class="s1">+ </span><span class="s0">'Please update your runtime to a newer version (' </span><span class="s1">+ </span><span class="s2">compilerInfo</span><span class="s1">[</span><span class="s5">1</span><span class="s1">] + </span><span class="s0">').'</span><span class="s1">);</span>
<a name="l49"><span class="ln">49   </span></a>  <span class="s1">}</span>
<a name="l50"><span class="ln">50   </span></a><span class="s1">}</span>
<a name="l51"><span class="ln">51   </span></a>
<a name="l52"><span class="ln">52   </span></a><span class="s3">function </span><span class="s2">template</span><span class="s1">(</span><span class="s2">templateSpec</span><span class="s1">, </span><span class="s2">env</span><span class="s1">) {</span>
<a name="l53"><span class="ln">53   </span></a>  <span class="s4">/* istanbul ignore next */</span>
<a name="l54"><span class="ln">54   </span></a>  <span class="s3">if </span><span class="s1">(!</span><span class="s2">env</span><span class="s1">) {</span>
<a name="l55"><span class="ln">55   </span></a>    <span class="s3">throw new </span><span class="s2">_exception2</span><span class="s1">[</span><span class="s0">'default'</span><span class="s1">](</span><span class="s0">'No environment passed to template'</span><span class="s1">);</span>
<a name="l56"><span class="ln">56   </span></a>  <span class="s1">}</span>
<a name="l57"><span class="ln">57   </span></a>  <span class="s3">if </span><span class="s1">(!</span><span class="s2">templateSpec </span><span class="s1">|| !</span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">main</span><span class="s1">) {</span>
<a name="l58"><span class="ln">58   </span></a>    <span class="s3">throw new </span><span class="s2">_exception2</span><span class="s1">[</span><span class="s0">'default'</span><span class="s1">](</span><span class="s0">'Unknown template object: ' </span><span class="s1">+ </span><span class="s3">typeof </span><span class="s2">templateSpec</span><span class="s1">);</span>
<a name="l59"><span class="ln">59   </span></a>  <span class="s1">}</span>
<a name="l60"><span class="ln">60   </span></a>
<a name="l61"><span class="ln">61   </span></a>  <span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">main</span><span class="s1">.</span><span class="s2">decorator </span><span class="s1">= </span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">main_d</span><span class="s1">;</span>
<a name="l62"><span class="ln">62   </span></a>
<a name="l63"><span class="ln">63   </span></a>  <span class="s4">// Note: Using env.VM references rather than local var references throughout this section to allow</span>
<a name="l64"><span class="ln">64   </span></a>  <span class="s4">// for external users to override these as pseudo-supported APIs.</span>
<a name="l65"><span class="ln">65   </span></a>  <span class="s2">env</span><span class="s1">.</span><span class="s2">VM</span><span class="s1">.</span><span class="s2">checkRevision</span><span class="s1">(</span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">compiler</span><span class="s1">);</span>
<a name="l66"><span class="ln">66   </span></a>
<a name="l67"><span class="ln">67   </span></a>  <span class="s4">// backwards compatibility for precompiled templates with compiler-version 7 (&lt;4.3.0)</span>
<a name="l68"><span class="ln">68   </span></a>  <span class="s3">var </span><span class="s2">templateWasPrecompiledWithCompilerV7 </span><span class="s1">= </span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">compiler </span><span class="s1">&amp;&amp; </span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">compiler</span><span class="s1">[</span><span class="s5">0</span><span class="s1">] === </span><span class="s5">7</span><span class="s1">;</span>
<a name="l69"><span class="ln">69   </span></a>
<a name="l70"><span class="ln">70   </span></a>  <span class="s3">function </span><span class="s2">invokePartialWrapper</span><span class="s1">(</span><span class="s2">partial</span><span class="s1">, </span><span class="s2">context</span><span class="s1">, </span><span class="s2">options</span><span class="s1">) {</span>
<a name="l71"><span class="ln">71   </span></a>    <span class="s3">if </span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">) {</span>
<a name="l72"><span class="ln">72   </span></a>      <span class="s2">context </span><span class="s1">= </span><span class="s2">Utils</span><span class="s1">.</span><span class="s2">extend</span><span class="s1">({}, </span><span class="s2">context</span><span class="s1">, </span><span class="s2">options</span><span class="s1">.</span><span class="s2">hash</span><span class="s1">);</span>
<a name="l73"><span class="ln">73   </span></a>      <span class="s3">if </span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">ids</span><span class="s1">) {</span>
<a name="l74"><span class="ln">74   </span></a>        <span class="s2">options</span><span class="s1">.</span><span class="s2">ids</span><span class="s1">[</span><span class="s5">0</span><span class="s1">] = </span><span class="s3">true</span><span class="s1">;</span>
<a name="l75"><span class="ln">75   </span></a>      <span class="s1">}</span>
<a name="l76"><span class="ln">76   </span></a>    <span class="s1">}</span>
<a name="l77"><span class="ln">77   </span></a>    <span class="s2">partial </span><span class="s1">= </span><span class="s2">env</span><span class="s1">.</span><span class="s2">VM</span><span class="s1">.</span><span class="s2">resolvePartial</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">partial</span><span class="s1">, </span><span class="s2">context</span><span class="s1">, </span><span class="s2">options</span><span class="s1">);</span>
<a name="l78"><span class="ln">78   </span></a>
<a name="l79"><span class="ln">79   </span></a>    <span class="s3">var </span><span class="s2">extendedOptions </span><span class="s1">= </span><span class="s2">Utils</span><span class="s1">.</span><span class="s2">extend</span><span class="s1">({}, </span><span class="s2">options</span><span class="s1">, {</span>
<a name="l80"><span class="ln">80   </span></a>      <span class="s2">hooks</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">hooks</span><span class="s1">,</span>
<a name="l81"><span class="ln">81   </span></a>      <span class="s2">protoAccessControl</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">protoAccessControl</span>
<a name="l82"><span class="ln">82   </span></a>    <span class="s1">});</span>
<a name="l83"><span class="ln">83   </span></a>
<a name="l84"><span class="ln">84   </span></a>    <span class="s3">var </span><span class="s2">result </span><span class="s1">= </span><span class="s2">env</span><span class="s1">.</span><span class="s2">VM</span><span class="s1">.</span><span class="s2">invokePartial</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">partial</span><span class="s1">, </span><span class="s2">context</span><span class="s1">, </span><span class="s2">extendedOptions</span><span class="s1">);</span>
<a name="l85"><span class="ln">85   </span></a>
<a name="l86"><span class="ln">86   </span></a>    <span class="s3">if </span><span class="s1">(</span><span class="s2">result </span><span class="s1">== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">env</span><span class="s1">.</span><span class="s2">compile</span><span class="s1">) {</span>
<a name="l87"><span class="ln">87   </span></a>      <span class="s2">options</span><span class="s1">.</span><span class="s2">partials</span><span class="s1">[</span><span class="s2">options</span><span class="s1">.</span><span class="s2">name</span><span class="s1">] = </span><span class="s2">env</span><span class="s1">.</span><span class="s2">compile</span><span class="s1">(</span><span class="s2">partial</span><span class="s1">, </span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">compilerOptions</span><span class="s1">, </span><span class="s2">env</span><span class="s1">);</span>
<a name="l88"><span class="ln">88   </span></a>      <span class="s2">result </span><span class="s1">= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">partials</span><span class="s1">[</span><span class="s2">options</span><span class="s1">.</span><span class="s2">name</span><span class="s1">](</span><span class="s2">context</span><span class="s1">, </span><span class="s2">extendedOptions</span><span class="s1">);</span>
<a name="l89"><span class="ln">89   </span></a>    <span class="s1">}</span>
<a name="l90"><span class="ln">90   </span></a>    <span class="s3">if </span><span class="s1">(</span><span class="s2">result </span><span class="s1">!= </span><span class="s3">null</span><span class="s1">) {</span>
<a name="l91"><span class="ln">91   </span></a>      <span class="s3">if </span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">indent</span><span class="s1">) {</span>
<a name="l92"><span class="ln">92   </span></a>        <span class="s3">var </span><span class="s2">lines </span><span class="s1">= </span><span class="s2">result</span><span class="s1">.</span><span class="s2">split</span><span class="s1">(</span><span class="s0">'</span><span class="s3">\n</span><span class="s0">'</span><span class="s1">);</span>
<a name="l93"><span class="ln">93   </span></a>        <span class="s3">for </span><span class="s1">(</span><span class="s3">var </span><span class="s2">i </span><span class="s1">= </span><span class="s5">0</span><span class="s1">, </span><span class="s2">l </span><span class="s1">= </span><span class="s2">lines</span><span class="s1">.</span><span class="s2">length</span><span class="s1">; </span><span class="s2">i </span><span class="s1">&lt; </span><span class="s2">l</span><span class="s1">; </span><span class="s2">i</span><span class="s1">++) {</span>
<a name="l94"><span class="ln">94   </span></a>          <span class="s3">if </span><span class="s1">(!</span><span class="s2">lines</span><span class="s1">[</span><span class="s2">i</span><span class="s1">] &amp;&amp; </span><span class="s2">i </span><span class="s1">+ </span><span class="s5">1 </span><span class="s1">=== </span><span class="s2">l</span><span class="s1">) {</span>
<a name="l95"><span class="ln">95   </span></a>            <span class="s3">break</span><span class="s1">;</span>
<a name="l96"><span class="ln">96   </span></a>          <span class="s1">}</span>
<a name="l97"><span class="ln">97   </span></a>
<a name="l98"><span class="ln">98   </span></a>          <span class="s2">lines</span><span class="s1">[</span><span class="s2">i</span><span class="s1">] = </span><span class="s2">options</span><span class="s1">.</span><span class="s2">indent </span><span class="s1">+ </span><span class="s2">lines</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span>
<a name="l99"><span class="ln">99   </span></a>        <span class="s1">}</span>
<a name="l100"><span class="ln">100  </span></a>        <span class="s2">result </span><span class="s1">= </span><span class="s2">lines</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">'</span><span class="s3">\n</span><span class="s0">'</span><span class="s1">);</span>
<a name="l101"><span class="ln">101  </span></a>      <span class="s1">}</span>
<a name="l102"><span class="ln">102  </span></a>      <span class="s3">return </span><span class="s2">result</span><span class="s1">;</span>
<a name="l103"><span class="ln">103  </span></a>    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
<a name="l104"><span class="ln">104  </span></a>      <span class="s3">throw new </span><span class="s2">_exception2</span><span class="s1">[</span><span class="s0">'default'</span><span class="s1">](</span><span class="s0">'The partial ' </span><span class="s1">+ </span><span class="s2">options</span><span class="s1">.</span><span class="s2">name </span><span class="s1">+ </span><span class="s0">' could not be compiled when running in runtime-only mode'</span><span class="s1">);</span>
<a name="l105"><span class="ln">105  </span></a>    <span class="s1">}</span>
<a name="l106"><span class="ln">106  </span></a>  <span class="s1">}</span>
<a name="l107"><span class="ln">107  </span></a>
<a name="l108"><span class="ln">108  </span></a>  <span class="s4">// Just add water</span>
<a name="l109"><span class="ln">109  </span></a>  <span class="s3">var </span><span class="s2">container </span><span class="s1">= {</span>
<a name="l110"><span class="ln">110  </span></a>    <span class="s2">strict</span><span class="s1">: </span><span class="s3">function </span><span class="s2">strict</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s2">name</span><span class="s1">, </span><span class="s2">loc</span><span class="s1">) {</span>
<a name="l111"><span class="ln">111  </span></a>      <span class="s3">if </span><span class="s1">(!</span><span class="s2">obj </span><span class="s1">|| !(</span><span class="s2">name </span><span class="s3">in </span><span class="s2">obj</span><span class="s1">)) {</span>
<a name="l112"><span class="ln">112  </span></a>        <span class="s3">throw new </span><span class="s2">_exception2</span><span class="s1">[</span><span class="s0">'default'</span><span class="s1">](</span><span class="s0">'&quot;' </span><span class="s1">+ </span><span class="s2">name </span><span class="s1">+ </span><span class="s0">'&quot; not defined in ' </span><span class="s1">+ </span><span class="s2">obj</span><span class="s1">, {</span>
<a name="l113"><span class="ln">113  </span></a>          <span class="s2">loc</span><span class="s1">: </span><span class="s2">loc</span>
<a name="l114"><span class="ln">114  </span></a>        <span class="s1">});</span>
<a name="l115"><span class="ln">115  </span></a>      <span class="s1">}</span>
<a name="l116"><span class="ln">116  </span></a>      <span class="s3">return </span><span class="s2">container</span><span class="s1">.</span><span class="s2">lookupProperty</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">, </span><span class="s2">name</span><span class="s1">);</span>
<a name="l117"><span class="ln">117  </span></a>    <span class="s1">},</span>
<a name="l118"><span class="ln">118  </span></a>    <span class="s2">lookupProperty</span><span class="s1">: </span><span class="s3">function </span><span class="s2">lookupProperty</span><span class="s1">(</span><span class="s2">parent</span><span class="s1">, </span><span class="s2">propertyName</span><span class="s1">) {</span>
<a name="l119"><span class="ln">119  </span></a>      <span class="s3">var </span><span class="s2">result </span><span class="s1">= </span><span class="s2">parent</span><span class="s1">[</span><span class="s2">propertyName</span><span class="s1">];</span>
<a name="l120"><span class="ln">120  </span></a>      <span class="s3">if </span><span class="s1">(</span><span class="s2">result </span><span class="s1">== </span><span class="s3">null</span><span class="s1">) {</span>
<a name="l121"><span class="ln">121  </span></a>        <span class="s3">return </span><span class="s2">result</span><span class="s1">;</span>
<a name="l122"><span class="ln">122  </span></a>      <span class="s1">}</span>
<a name="l123"><span class="ln">123  </span></a>      <span class="s3">if </span><span class="s1">(</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">hasOwnProperty</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">parent</span><span class="s1">, </span><span class="s2">propertyName</span><span class="s1">)) {</span>
<a name="l124"><span class="ln">124  </span></a>        <span class="s3">return </span><span class="s2">result</span><span class="s1">;</span>
<a name="l125"><span class="ln">125  </span></a>      <span class="s1">}</span>
<a name="l126"><span class="ln">126  </span></a>
<a name="l127"><span class="ln">127  </span></a>      <span class="s3">if </span><span class="s1">(</span><span class="s2">_internalProtoAccess</span><span class="s1">.</span><span class="s2">resultIsAllowed</span><span class="s1">(</span><span class="s2">result</span><span class="s1">, </span><span class="s2">container</span><span class="s1">.</span><span class="s2">protoAccessControl</span><span class="s1">, </span><span class="s2">propertyName</span><span class="s1">)) {</span>
<a name="l128"><span class="ln">128  </span></a>        <span class="s3">return </span><span class="s2">result</span><span class="s1">;</span>
<a name="l129"><span class="ln">129  </span></a>      <span class="s1">}</span>
<a name="l130"><span class="ln">130  </span></a>      <span class="s3">return </span><span class="s2">undefined</span><span class="s1">;</span>
<a name="l131"><span class="ln">131  </span></a>    <span class="s1">},</span>
<a name="l132"><span class="ln">132  </span></a>    <span class="s2">lookup</span><span class="s1">: </span><span class="s3">function </span><span class="s2">lookup</span><span class="s1">(</span><span class="s2">depths</span><span class="s1">, </span><span class="s2">name</span><span class="s1">) {</span>
<a name="l133"><span class="ln">133  </span></a>      <span class="s3">var </span><span class="s2">len </span><span class="s1">= </span><span class="s2">depths</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span>
<a name="l134"><span class="ln">134  </span></a>      <span class="s3">for </span><span class="s1">(</span><span class="s3">var </span><span class="s2">i </span><span class="s1">= </span><span class="s5">0</span><span class="s1">; </span><span class="s2">i </span><span class="s1">&lt; </span><span class="s2">len</span><span class="s1">; </span><span class="s2">i</span><span class="s1">++) {</span>
<a name="l135"><span class="ln">135  </span></a>        <span class="s3">var </span><span class="s2">result </span><span class="s1">= </span><span class="s2">depths</span><span class="s1">[</span><span class="s2">i</span><span class="s1">] &amp;&amp; </span><span class="s2">container</span><span class="s1">.</span><span class="s2">lookupProperty</span><span class="s1">(</span><span class="s2">depths</span><span class="s1">[</span><span class="s2">i</span><span class="s1">], </span><span class="s2">name</span><span class="s1">);</span>
<a name="l136"><span class="ln">136  </span></a>        <span class="s3">if </span><span class="s1">(</span><span class="s2">result </span><span class="s1">!= </span><span class="s3">null</span><span class="s1">) {</span>
<a name="l137"><span class="ln">137  </span></a>          <span class="s3">return </span><span class="s2">depths</span><span class="s1">[</span><span class="s2">i</span><span class="s1">][</span><span class="s2">name</span><span class="s1">];</span>
<a name="l138"><span class="ln">138  </span></a>        <span class="s1">}</span>
<a name="l139"><span class="ln">139  </span></a>      <span class="s1">}</span>
<a name="l140"><span class="ln">140  </span></a>    <span class="s1">},</span>
<a name="l141"><span class="ln">141  </span></a>    <span class="s2">lambda</span><span class="s1">: </span><span class="s3">function </span><span class="s2">lambda</span><span class="s1">(</span><span class="s2">current</span><span class="s1">, </span><span class="s2">context</span><span class="s1">) {</span>
<a name="l142"><span class="ln">142  </span></a>      <span class="s3">return typeof </span><span class="s2">current </span><span class="s1">=== </span><span class="s0">'function' </span><span class="s1">? </span><span class="s2">current</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s2">context</span><span class="s1">) : </span><span class="s2">current</span><span class="s1">;</span>
<a name="l143"><span class="ln">143  </span></a>    <span class="s1">},</span>
<a name="l144"><span class="ln">144  </span></a>
<a name="l145"><span class="ln">145  </span></a>    <span class="s2">escapeExpression</span><span class="s1">: </span><span class="s2">Utils</span><span class="s1">.</span><span class="s2">escapeExpression</span><span class="s1">,</span>
<a name="l146"><span class="ln">146  </span></a>    <span class="s2">invokePartial</span><span class="s1">: </span><span class="s2">invokePartialWrapper</span><span class="s1">,</span>
<a name="l147"><span class="ln">147  </span></a>
<a name="l148"><span class="ln">148  </span></a>    <span class="s2">fn</span><span class="s1">: </span><span class="s3">function </span><span class="s2">fn</span><span class="s1">(</span><span class="s2">i</span><span class="s1">) {</span>
<a name="l149"><span class="ln">149  </span></a>      <span class="s3">var </span><span class="s2">ret </span><span class="s1">= </span><span class="s2">templateSpec</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span>
<a name="l150"><span class="ln">150  </span></a>      <span class="s2">ret</span><span class="s1">.</span><span class="s2">decorator </span><span class="s1">= </span><span class="s2">templateSpec</span><span class="s1">[</span><span class="s2">i </span><span class="s1">+ </span><span class="s0">'_d'</span><span class="s1">];</span>
<a name="l151"><span class="ln">151  </span></a>      <span class="s3">return </span><span class="s2">ret</span><span class="s1">;</span>
<a name="l152"><span class="ln">152  </span></a>    <span class="s1">},</span>
<a name="l153"><span class="ln">153  </span></a>
<a name="l154"><span class="ln">154  </span></a>    <span class="s2">programs</span><span class="s1">: [],</span>
<a name="l155"><span class="ln">155  </span></a>    <span class="s2">program</span><span class="s1">: </span><span class="s3">function </span><span class="s2">program</span><span class="s1">(</span><span class="s2">i</span><span class="s1">, </span><span class="s2">data</span><span class="s1">, </span><span class="s2">declaredBlockParams</span><span class="s1">, </span><span class="s2">blockParams</span><span class="s1">, </span><span class="s2">depths</span><span class="s1">) {</span>
<a name="l156"><span class="ln">156  </span></a>      <span class="s3">var </span><span class="s2">programWrapper </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">programs</span><span class="s1">[</span><span class="s2">i</span><span class="s1">],</span>
<a name="l157"><span class="ln">157  </span></a>          <span class="s2">fn </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">fn</span><span class="s1">(</span><span class="s2">i</span><span class="s1">);</span>
<a name="l158"><span class="ln">158  </span></a>      <span class="s3">if </span><span class="s1">(</span><span class="s2">data </span><span class="s1">|| </span><span class="s2">depths </span><span class="s1">|| </span><span class="s2">blockParams </span><span class="s1">|| </span><span class="s2">declaredBlockParams</span><span class="s1">) {</span>
<a name="l159"><span class="ln">159  </span></a>        <span class="s2">programWrapper </span><span class="s1">= </span><span class="s2">wrapProgram</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">i</span><span class="s1">, </span><span class="s2">fn</span><span class="s1">, </span><span class="s2">data</span><span class="s1">, </span><span class="s2">declaredBlockParams</span><span class="s1">, </span><span class="s2">blockParams</span><span class="s1">, </span><span class="s2">depths</span><span class="s1">);</span>
<a name="l160"><span class="ln">160  </span></a>      <span class="s1">} </span><span class="s3">else if </span><span class="s1">(!</span><span class="s2">programWrapper</span><span class="s1">) {</span>
<a name="l161"><span class="ln">161  </span></a>        <span class="s2">programWrapper </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">programs</span><span class="s1">[</span><span class="s2">i</span><span class="s1">] = </span><span class="s2">wrapProgram</span><span class="s1">(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">i</span><span class="s1">, </span><span class="s2">fn</span><span class="s1">);</span>
<a name="l162"><span class="ln">162  </span></a>      <span class="s1">}</span>
<a name="l163"><span class="ln">163  </span></a>      <span class="s3">return </span><span class="s2">programWrapper</span><span class="s1">;</span>
<a name="l164"><span class="ln">164  </span></a>    <span class="s1">},</span>
<a name="l165"><span class="ln">165  </span></a>
<a name="l166"><span class="ln">166  </span></a>    <span class="s2">data</span><span class="s1">: </span><span class="s3">function </span><span class="s2">data</span><span class="s1">(</span><span class="s2">value</span><span class="s1">, </span><span class="s2">depth</span><span class="s1">) {</span>
<a name="l167"><span class="ln">167  </span></a>      <span class="s3">while </span><span class="s1">(</span><span class="s2">value </span><span class="s1">&amp;&amp; </span><span class="s2">depth</span><span class="s1">--) {</span>
<a name="l168"><span class="ln">168  </span></a>        <span class="s2">value </span><span class="s1">= </span><span class="s2">value</span><span class="s1">.</span><span class="s2">_parent</span><span class="s1">;</span>
<a name="l169"><span class="ln">169  </span></a>      <span class="s1">}</span>
<a name="l170"><span class="ln">170  </span></a>      <span class="s3">return </span><span class="s2">value</span><span class="s1">;</span>
<a name="l171"><span class="ln">171  </span></a>    <span class="s1">},</span>
<a name="l172"><span class="ln">172  </span></a>    <span class="s2">mergeIfNeeded</span><span class="s1">: </span><span class="s3">function </span><span class="s2">mergeIfNeeded</span><span class="s1">(</span><span class="s2">param</span><span class="s1">, </span><span class="s2">common</span><span class="s1">) {</span>
<a name="l173"><span class="ln">173  </span></a>      <span class="s3">var </span><span class="s2">obj </span><span class="s1">= </span><span class="s2">param </span><span class="s1">|| </span><span class="s2">common</span><span class="s1">;</span>
<a name="l174"><span class="ln">174  </span></a>
<a name="l175"><span class="ln">175  </span></a>      <span class="s3">if </span><span class="s1">(</span><span class="s2">param </span><span class="s1">&amp;&amp; </span><span class="s2">common </span><span class="s1">&amp;&amp; </span><span class="s2">param </span><span class="s1">!== </span><span class="s2">common</span><span class="s1">) {</span>
<a name="l176"><span class="ln">176  </span></a>        <span class="s2">obj </span><span class="s1">= </span><span class="s2">Utils</span><span class="s1">.</span><span class="s2">extend</span><span class="s1">({}, </span><span class="s2">common</span><span class="s1">, </span><span class="s2">param</span><span class="s1">);</span>
<a name="l177"><span class="ln">177  </span></a>      <span class="s1">}</span>
<a name="l178"><span class="ln">178  </span></a>
<a name="l179"><span class="ln">179  </span></a>      <span class="s3">return </span><span class="s2">obj</span><span class="s1">;</span>
<a name="l180"><span class="ln">180  </span></a>    <span class="s1">},</span>
<a name="l181"><span class="ln">181  </span></a>    <span class="s4">// An empty object to use as replacement for null-contexts</span>
<a name="l182"><span class="ln">182  </span></a>    <span class="s2">nullContext</span><span class="s1">: </span><span class="s2">Object</span><span class="s1">.</span><span class="s2">seal</span><span class="s1">({}),</span>
<a name="l183"><span class="ln">183  </span></a>
<a name="l184"><span class="ln">184  </span></a>    <span class="s2">noop</span><span class="s1">: </span><span class="s2">env</span><span class="s1">.</span><span class="s2">VM</span><span class="s1">.</span><span class="s2">noop</span><span class="s1">,</span>
<a name="l185"><span class="ln">185  </span></a>    <span class="s2">compilerInfo</span><span class="s1">: </span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">compiler</span>
<a name="l186"><span class="ln">186  </span></a>  <span class="s1">};</span>
<a name="l187"><span class="ln">187  </span></a>
<a name="l188"><span class="ln">188  </span></a>  <span class="s3">function </span><span class="s2">ret</span><span class="s1">(</span><span class="s2">context</span><span class="s1">) {</span>
<a name="l189"><span class="ln">189  </span></a>    <span class="s3">var </span><span class="s2">options </span><span class="s1">= </span><span class="s2">arguments</span><span class="s1">.</span><span class="s2">length </span><span class="s1">&lt;= </span><span class="s5">1 </span><span class="s1">|| </span><span class="s2">arguments</span><span class="s1">[</span><span class="s5">1</span><span class="s1">] === </span><span class="s2">undefined </span><span class="s1">? {} : </span><span class="s2">arguments</span><span class="s1">[</span><span class="s5">1</span><span class="s1">];</span>
<a name="l190"><span class="ln">190  </span></a>
<a name="l191"><span class="ln">191  </span></a>    <span class="s3">var </span><span class="s2">data </span><span class="s1">= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">data</span><span class="s1">;</span>
<a name="l192"><span class="ln">192  </span></a>
<a name="l193"><span class="ln">193  </span></a>    <span class="s2">ret</span><span class="s1">.</span><span class="s2">_setup</span><span class="s1">(</span><span class="s2">options</span><span class="s1">);</span>
<a name="l194"><span class="ln">194  </span></a>    <span class="s3">if </span><span class="s1">(!</span><span class="s2">options</span><span class="s1">.</span><span class="s2">partial </span><span class="s1">&amp;&amp; </span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">useData</span><span class="s1">) {</span>
<a name="l195"><span class="ln">195  </span></a>      <span class="s2">data </span><span class="s1">= </span><span class="s2">initData</span><span class="s1">(</span><span class="s2">context</span><span class="s1">, </span><span class="s2">data</span><span class="s1">);</span>
<a name="l196"><span class="ln">196  </span></a>    <span class="s1">}</span>
<a name="l197"><span class="ln">197  </span></a>    <span class="s3">var </span><span class="s2">depths </span><span class="s1">= </span><span class="s2">undefined</span><span class="s1">,</span>
<a name="l198"><span class="ln">198  </span></a>        <span class="s2">blockParams </span><span class="s1">= </span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">useBlockParams </span><span class="s1">? [] : </span><span class="s2">undefined</span><span class="s1">;</span>
<a name="l199"><span class="ln">199  </span></a>    <span class="s3">if </span><span class="s1">(</span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">useDepths</span><span class="s1">) {</span>
<a name="l200"><span class="ln">200  </span></a>      <span class="s3">if </span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">depths</span><span class="s1">) {</span>
<a name="l201"><span class="ln">201  </span></a>        <span class="s2">depths </span><span class="s1">= </span><span class="s2">context </span><span class="s1">!= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">depths</span><span class="s1">[</span><span class="s5">0</span><span class="s1">] ? [</span><span class="s2">context</span><span class="s1">].</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">depths</span><span class="s1">) : </span><span class="s2">options</span><span class="s1">.</span><span class="s2">depths</span><span class="s1">;</span>
<a name="l202"><span class="ln">202  </span></a>      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
<a name="l203"><span class="ln">203  </span></a>        <span class="s2">depths </span><span class="s1">= [</span><span class="s2">context</span><span class="s1">];</span>
<a name="l204"><span class="ln">204  </span></a>      <span class="s1">}</span>
<a name="l205"><span class="ln">205  </span></a>    <span class="s1">}</span>
<a name="l206"><span class="ln">206  </span></a>
<a name="l207"><span class="ln">207  </span></a>    <span class="s3">function </span><span class="s2">main</span><span class="s1">(</span><span class="s2">context </span><span class="s4">/*, options*/</span><span class="s1">) {</span>
<a name="l208"><span class="ln">208  </span></a>      <span class="s3">return </span><span class="s0">'' </span><span class="s1">+ </span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">main</span><span class="s1">(</span><span class="s2">container</span><span class="s1">, </span><span class="s2">context</span><span class="s1">, </span><span class="s2">container</span><span class="s1">.</span><span class="s2">helpers</span><span class="s1">, </span><span class="s2">container</span><span class="s1">.</span><span class="s2">partials</span><span class="s1">, </span><span class="s2">data</span><span class="s1">, </span><span class="s2">blockParams</span><span class="s1">, </span><span class="s2">depths</span><span class="s1">);</span>
<a name="l209"><span class="ln">209  </span></a>    <span class="s1">}</span>
<a name="l210"><span class="ln">210  </span></a>
<a name="l211"><span class="ln">211  </span></a>    <span class="s2">main </span><span class="s1">= </span><span class="s2">executeDecorators</span><span class="s1">(</span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">main</span><span class="s1">, </span><span class="s2">main</span><span class="s1">, </span><span class="s2">container</span><span class="s1">, </span><span class="s2">options</span><span class="s1">.</span><span class="s2">depths </span><span class="s1">|| [], </span><span class="s2">data</span><span class="s1">, </span><span class="s2">blockParams</span><span class="s1">);</span>
<a name="l212"><span class="ln">212  </span></a>    <span class="s3">return </span><span class="s2">main</span><span class="s1">(</span><span class="s2">context</span><span class="s1">, </span><span class="s2">options</span><span class="s1">);</span>
<a name="l213"><span class="ln">213  </span></a>  <span class="s1">}</span>
<a name="l214"><span class="ln">214  </span></a>
<a name="l215"><span class="ln">215  </span></a>  <span class="s2">ret</span><span class="s1">.</span><span class="s2">isTop </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
<a name="l216"><span class="ln">216  </span></a>
<a name="l217"><span class="ln">217  </span></a>  <span class="s2">ret</span><span class="s1">.</span><span class="s2">_setup </span><span class="s1">= </span><span class="s3">function </span><span class="s1">(</span><span class="s2">options</span><span class="s1">) {</span>
<a name="l218"><span class="ln">218  </span></a>    <span class="s3">if </span><span class="s1">(!</span><span class="s2">options</span><span class="s1">.</span><span class="s2">partial</span><span class="s1">) {</span>
<a name="l219"><span class="ln">219  </span></a>      <span class="s3">var </span><span class="s2">mergedHelpers </span><span class="s1">= </span><span class="s2">Utils</span><span class="s1">.</span><span class="s2">extend</span><span class="s1">({}, </span><span class="s2">env</span><span class="s1">.</span><span class="s2">helpers</span><span class="s1">, </span><span class="s2">options</span><span class="s1">.</span><span class="s2">helpers</span><span class="s1">);</span>
<a name="l220"><span class="ln">220  </span></a>      <span class="s2">wrapHelpersToPassLookupProperty</span><span class="s1">(</span><span class="s2">mergedHelpers</span><span class="s1">, </span><span class="s2">container</span><span class="s1">);</span>
<a name="l221"><span class="ln">221  </span></a>      <span class="s2">container</span><span class="s1">.</span><span class="s2">helpers </span><span class="s1">= </span><span class="s2">mergedHelpers</span><span class="s1">;</span>
<a name="l222"><span class="ln">222  </span></a>
<a name="l223"><span class="ln">223  </span></a>      <span class="s3">if </span><span class="s1">(</span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">usePartial</span><span class="s1">) {</span>
<a name="l224"><span class="ln">224  </span></a>        <span class="s4">// Use mergeIfNeeded here to prevent compiling global partials multiple times</span>
<a name="l225"><span class="ln">225  </span></a>        <span class="s2">container</span><span class="s1">.</span><span class="s2">partials </span><span class="s1">= </span><span class="s2">container</span><span class="s1">.</span><span class="s2">mergeIfNeeded</span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">partials</span><span class="s1">, </span><span class="s2">env</span><span class="s1">.</span><span class="s2">partials</span><span class="s1">);</span>
<a name="l226"><span class="ln">226  </span></a>      <span class="s1">}</span>
<a name="l227"><span class="ln">227  </span></a>      <span class="s3">if </span><span class="s1">(</span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">usePartial </span><span class="s1">|| </span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">useDecorators</span><span class="s1">) {</span>
<a name="l228"><span class="ln">228  </span></a>        <span class="s2">container</span><span class="s1">.</span><span class="s2">decorators </span><span class="s1">= </span><span class="s2">Utils</span><span class="s1">.</span><span class="s2">extend</span><span class="s1">({}, </span><span class="s2">env</span><span class="s1">.</span><span class="s2">decorators</span><span class="s1">, </span><span class="s2">options</span><span class="s1">.</span><span class="s2">decorators</span><span class="s1">);</span>
<a name="l229"><span class="ln">229  </span></a>      <span class="s1">}</span>
<a name="l230"><span class="ln">230  </span></a>
<a name="l231"><span class="ln">231  </span></a>      <span class="s2">container</span><span class="s1">.</span><span class="s2">hooks </span><span class="s1">= {};</span>
<a name="l232"><span class="ln">232  </span></a>      <span class="s2">container</span><span class="s1">.</span><span class="s2">protoAccessControl </span><span class="s1">= </span><span class="s2">_internalProtoAccess</span><span class="s1">.</span><span class="s2">createProtoAccessControl</span><span class="s1">(</span><span class="s2">options</span><span class="s1">);</span>
<a name="l233"><span class="ln">233  </span></a>
<a name="l234"><span class="ln">234  </span></a>      <span class="s3">var </span><span class="s2">keepHelperInHelpers </span><span class="s1">= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">allowCallsToHelperMissing </span><span class="s1">|| </span><span class="s2">templateWasPrecompiledWithCompilerV7</span><span class="s1">;</span>
<a name="l235"><span class="ln">235  </span></a>      <span class="s2">_helpers</span><span class="s1">.</span><span class="s2">moveHelperToHooks</span><span class="s1">(</span><span class="s2">container</span><span class="s1">, </span><span class="s0">'helperMissing'</span><span class="s1">, </span><span class="s2">keepHelperInHelpers</span><span class="s1">);</span>
<a name="l236"><span class="ln">236  </span></a>      <span class="s2">_helpers</span><span class="s1">.</span><span class="s2">moveHelperToHooks</span><span class="s1">(</span><span class="s2">container</span><span class="s1">, </span><span class="s0">'blockHelperMissing'</span><span class="s1">, </span><span class="s2">keepHelperInHelpers</span><span class="s1">);</span>
<a name="l237"><span class="ln">237  </span></a>    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
<a name="l238"><span class="ln">238  </span></a>      <span class="s2">container</span><span class="s1">.</span><span class="s2">protoAccessControl </span><span class="s1">= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">protoAccessControl</span><span class="s1">; </span><span class="s4">// internal option</span>
<a name="l239"><span class="ln">239  </span></a>      <span class="s2">container</span><span class="s1">.</span><span class="s2">helpers </span><span class="s1">= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">helpers</span><span class="s1">;</span>
<a name="l240"><span class="ln">240  </span></a>      <span class="s2">container</span><span class="s1">.</span><span class="s2">partials </span><span class="s1">= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">partials</span><span class="s1">;</span>
<a name="l241"><span class="ln">241  </span></a>      <span class="s2">container</span><span class="s1">.</span><span class="s2">decorators </span><span class="s1">= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">decorators</span><span class="s1">;</span>
<a name="l242"><span class="ln">242  </span></a>      <span class="s2">container</span><span class="s1">.</span><span class="s2">hooks </span><span class="s1">= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">hooks</span><span class="s1">;</span>
<a name="l243"><span class="ln">243  </span></a>    <span class="s1">}</span>
<a name="l244"><span class="ln">244  </span></a>  <span class="s1">};</span>
<a name="l245"><span class="ln">245  </span></a>
<a name="l246"><span class="ln">246  </span></a>  <span class="s2">ret</span><span class="s1">.</span><span class="s2">_child </span><span class="s1">= </span><span class="s3">function </span><span class="s1">(</span><span class="s2">i</span><span class="s1">, </span><span class="s2">data</span><span class="s1">, </span><span class="s2">blockParams</span><span class="s1">, </span><span class="s2">depths</span><span class="s1">) {</span>
<a name="l247"><span class="ln">247  </span></a>    <span class="s3">if </span><span class="s1">(</span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">useBlockParams </span><span class="s1">&amp;&amp; !</span><span class="s2">blockParams</span><span class="s1">) {</span>
<a name="l248"><span class="ln">248  </span></a>      <span class="s3">throw new </span><span class="s2">_exception2</span><span class="s1">[</span><span class="s0">'default'</span><span class="s1">](</span><span class="s0">'must pass block params'</span><span class="s1">);</span>
<a name="l249"><span class="ln">249  </span></a>    <span class="s1">}</span>
<a name="l250"><span class="ln">250  </span></a>    <span class="s3">if </span><span class="s1">(</span><span class="s2">templateSpec</span><span class="s1">.</span><span class="s2">useDepths </span><span class="s1">&amp;&amp; !</span><span class="s2">depths</span><span class="s1">) {</span>
<a name="l251"><span class="ln">251  </span></a>      <span class="s3">throw new </span><span class="s2">_exception2</span><span class="s1">[</span><span class="s0">'default'</span><span class="s1">](</span><span class="s0">'must pass parent depths'</span><span class="s1">);</span>
<a name="l252"><span class="ln">252  </span></a>    <span class="s1">}</span>
<a name="l253"><span class="ln">253  </span></a>
<a name="l254"><span class="ln">254  </span></a>    <span class="s3">return </span><span class="s2">wrapProgram</span><span class="s1">(</span><span class="s2">container</span><span class="s1">, </span><span class="s2">i</span><span class="s1">, </span><span class="s2">templateSpec</span><span class="s1">[</span><span class="s2">i</span><span class="s1">], </span><span class="s2">data</span><span class="s1">, </span><span class="s5">0</span><span class="s1">, </span><span class="s2">blockParams</span><span class="s1">, </span><span class="s2">depths</span><span class="s1">);</span>
<a name="l255"><span class="ln">255  </span></a>  <span class="s1">};</span>
<a name="l256"><span class="ln">256  </span></a>  <span class="s3">return </span><span class="s2">ret</span><span class="s1">;</span>
<a name="l257"><span class="ln">257  </span></a><span class="s1">}</span>
<a name="l258"><span class="ln">258  </span></a>
<a name="l259"><span class="ln">259  </span></a><span class="s3">function </span><span class="s2">wrapProgram</span><span class="s1">(</span><span class="s2">container</span><span class="s1">, </span><span class="s2">i</span><span class="s1">, </span><span class="s2">fn</span><span class="s1">, </span><span class="s2">data</span><span class="s1">, </span><span class="s2">declaredBlockParams</span><span class="s1">, </span><span class="s2">blockParams</span><span class="s1">, </span><span class="s2">depths</span><span class="s1">) {</span>
<a name="l260"><span class="ln">260  </span></a>  <span class="s3">function </span><span class="s2">prog</span><span class="s1">(</span><span class="s2">context</span><span class="s1">) {</span>
<a name="l261"><span class="ln">261  </span></a>    <span class="s3">var </span><span class="s2">options </span><span class="s1">= </span><span class="s2">arguments</span><span class="s1">.</span><span class="s2">length </span><span class="s1">&lt;= </span><span class="s5">1 </span><span class="s1">|| </span><span class="s2">arguments</span><span class="s1">[</span><span class="s5">1</span><span class="s1">] === </span><span class="s2">undefined </span><span class="s1">? {} : </span><span class="s2">arguments</span><span class="s1">[</span><span class="s5">1</span><span class="s1">];</span>
<a name="l262"><span class="ln">262  </span></a>
<a name="l263"><span class="ln">263  </span></a>    <span class="s3">var </span><span class="s2">currentDepths </span><span class="s1">= </span><span class="s2">depths</span><span class="s1">;</span>
<a name="l264"><span class="ln">264  </span></a>    <span class="s3">if </span><span class="s1">(</span><span class="s2">depths </span><span class="s1">&amp;&amp; </span><span class="s2">context </span><span class="s1">!= </span><span class="s2">depths</span><span class="s1">[</span><span class="s5">0</span><span class="s1">] &amp;&amp; !(</span><span class="s2">context </span><span class="s1">=== </span><span class="s2">container</span><span class="s1">.</span><span class="s2">nullContext </span><span class="s1">&amp;&amp; </span><span class="s2">depths</span><span class="s1">[</span><span class="s5">0</span><span class="s1">] === </span><span class="s3">null</span><span class="s1">)) {</span>
<a name="l265"><span class="ln">265  </span></a>      <span class="s2">currentDepths </span><span class="s1">= [</span><span class="s2">context</span><span class="s1">].</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">depths</span><span class="s1">);</span>
<a name="l266"><span class="ln">266  </span></a>    <span class="s1">}</span>
<a name="l267"><span class="ln">267  </span></a>
<a name="l268"><span class="ln">268  </span></a>    <span class="s3">return </span><span class="s2">fn</span><span class="s1">(</span><span class="s2">container</span><span class="s1">, </span><span class="s2">context</span><span class="s1">, </span><span class="s2">container</span><span class="s1">.</span><span class="s2">helpers</span><span class="s1">, </span><span class="s2">container</span><span class="s1">.</span><span class="s2">partials</span><span class="s1">, </span><span class="s2">options</span><span class="s1">.</span><span class="s2">data </span><span class="s1">|| </span><span class="s2">data</span><span class="s1">, </span><span class="s2">blockParams </span><span class="s1">&amp;&amp; [</span><span class="s2">options</span><span class="s1">.</span><span class="s2">blockParams</span><span class="s1">].</span><span class="s2">concat</span><span class="s1">(</span><span class="s2">blockParams</span><span class="s1">), </span><span class="s2">currentDepths</span><span class="s1">);</span>
<a name="l269"><span class="ln">269  </span></a>  <span class="s1">}</span>
<a name="l270"><span class="ln">270  </span></a>
<a name="l271"><span class="ln">271  </span></a>  <span class="s2">prog </span><span class="s1">= </span><span class="s2">executeDecorators</span><span class="s1">(</span><span class="s2">fn</span><span class="s1">, </span><span class="s2">prog</span><span class="s1">, </span><span class="s2">container</span><span class="s1">, </span><span class="s2">depths</span><span class="s1">, </span><span class="s2">data</span><span class="s1">, </span><span class="s2">blockParams</span><span class="s1">);</span>
<a name="l272"><span class="ln">272  </span></a>
<a name="l273"><span class="ln">273  </span></a>  <span class="s2">prog</span><span class="s1">.</span><span class="s2">program </span><span class="s1">= </span><span class="s2">i</span><span class="s1">;</span>
<a name="l274"><span class="ln">274  </span></a>  <span class="s2">prog</span><span class="s1">.</span><span class="s2">depth </span><span class="s1">= </span><span class="s2">depths </span><span class="s1">? </span><span class="s2">depths</span><span class="s1">.</span><span class="s2">length </span><span class="s1">: </span><span class="s5">0</span><span class="s1">;</span>
<a name="l275"><span class="ln">275  </span></a>  <span class="s2">prog</span><span class="s1">.</span><span class="s2">blockParams </span><span class="s1">= </span><span class="s2">declaredBlockParams </span><span class="s1">|| </span><span class="s5">0</span><span class="s1">;</span>
<a name="l276"><span class="ln">276  </span></a>  <span class="s3">return </span><span class="s2">prog</span><span class="s1">;</span>
<a name="l277"><span class="ln">277  </span></a><span class="s1">}</span>
<a name="l278"><span class="ln">278  </span></a>
<a name="l279"><span class="ln">279  </span></a><span class="s6">/**</span>
<a name="l280"><span class="ln">280  </span></a> <span class="s6">* This is currently part of the official API, therefore implementation details should not be changed.</span>
<a name="l281"><span class="ln">281  </span></a> <span class="s6">*/</span>
<a name="l282"><span class="ln">282  </span></a>
<a name="l283"><span class="ln">283  </span></a><span class="s3">function </span><span class="s2">resolvePartial</span><span class="s1">(</span><span class="s2">partial</span><span class="s1">, </span><span class="s2">context</span><span class="s1">, </span><span class="s2">options</span><span class="s1">) {</span>
<a name="l284"><span class="ln">284  </span></a>  <span class="s3">if </span><span class="s1">(!</span><span class="s2">partial</span><span class="s1">) {</span>
<a name="l285"><span class="ln">285  </span></a>    <span class="s3">if </span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">name </span><span class="s1">=== </span><span class="s0">'@partial-block'</span><span class="s1">) {</span>
<a name="l286"><span class="ln">286  </span></a>      <span class="s2">partial </span><span class="s1">= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">data</span><span class="s1">[</span><span class="s0">'partial-block'</span><span class="s1">];</span>
<a name="l287"><span class="ln">287  </span></a>    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
<a name="l288"><span class="ln">288  </span></a>      <span class="s2">partial </span><span class="s1">= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">partials</span><span class="s1">[</span><span class="s2">options</span><span class="s1">.</span><span class="s2">name</span><span class="s1">];</span>
<a name="l289"><span class="ln">289  </span></a>    <span class="s1">}</span>
<a name="l290"><span class="ln">290  </span></a>  <span class="s1">} </span><span class="s3">else if </span><span class="s1">(!</span><span class="s2">partial</span><span class="s1">.</span><span class="s2">call </span><span class="s1">&amp;&amp; !</span><span class="s2">options</span><span class="s1">.</span><span class="s2">name</span><span class="s1">) {</span>
<a name="l291"><span class="ln">291  </span></a>    <span class="s4">// This is a dynamic partial that returned a string</span>
<a name="l292"><span class="ln">292  </span></a>    <span class="s2">options</span><span class="s1">.</span><span class="s2">name </span><span class="s1">= </span><span class="s2">partial</span><span class="s1">;</span>
<a name="l293"><span class="ln">293  </span></a>    <span class="s2">partial </span><span class="s1">= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">partials</span><span class="s1">[</span><span class="s2">partial</span><span class="s1">];</span>
<a name="l294"><span class="ln">294  </span></a>  <span class="s1">}</span>
<a name="l295"><span class="ln">295  </span></a>  <span class="s3">return </span><span class="s2">partial</span><span class="s1">;</span>
<a name="l296"><span class="ln">296  </span></a><span class="s1">}</span>
<a name="l297"><span class="ln">297  </span></a>
<a name="l298"><span class="ln">298  </span></a><span class="s3">function </span><span class="s2">invokePartial</span><span class="s1">(</span><span class="s2">partial</span><span class="s1">, </span><span class="s2">context</span><span class="s1">, </span><span class="s2">options</span><span class="s1">) {</span>
<a name="l299"><span class="ln">299  </span></a>  <span class="s4">// Use the current closure context to save the partial-block if this partial</span>
<a name="l300"><span class="ln">300  </span></a>  <span class="s3">var </span><span class="s2">currentPartialBlock </span><span class="s1">= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">data </span><span class="s1">&amp;&amp; </span><span class="s2">options</span><span class="s1">.</span><span class="s2">data</span><span class="s1">[</span><span class="s0">'partial-block'</span><span class="s1">];</span>
<a name="l301"><span class="ln">301  </span></a>  <span class="s2">options</span><span class="s1">.</span><span class="s2">partial </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
<a name="l302"><span class="ln">302  </span></a>  <span class="s3">if </span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">ids</span><span class="s1">) {</span>
<a name="l303"><span class="ln">303  </span></a>    <span class="s2">options</span><span class="s1">.</span><span class="s2">data</span><span class="s1">.</span><span class="s2">contextPath </span><span class="s1">= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">ids</span><span class="s1">[</span><span class="s5">0</span><span class="s1">] || </span><span class="s2">options</span><span class="s1">.</span><span class="s2">data</span><span class="s1">.</span><span class="s2">contextPath</span><span class="s1">;</span>
<a name="l304"><span class="ln">304  </span></a>  <span class="s1">}</span>
<a name="l305"><span class="ln">305  </span></a>
<a name="l306"><span class="ln">306  </span></a>  <span class="s3">var </span><span class="s2">partialBlock </span><span class="s1">= </span><span class="s2">undefined</span><span class="s1">;</span>
<a name="l307"><span class="ln">307  </span></a>  <span class="s3">if </span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">fn </span><span class="s1">&amp;&amp; </span><span class="s2">options</span><span class="s1">.</span><span class="s2">fn </span><span class="s1">!== </span><span class="s2">noop</span><span class="s1">) {</span>
<a name="l308"><span class="ln">308  </span></a>    <span class="s1">(</span><span class="s3">function </span><span class="s1">() {</span>
<a name="l309"><span class="ln">309  </span></a>      <span class="s2">options</span><span class="s1">.</span><span class="s2">data </span><span class="s1">= </span><span class="s2">_base</span><span class="s1">.</span><span class="s2">createFrame</span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">data</span><span class="s1">);</span>
<a name="l310"><span class="ln">310  </span></a>      <span class="s4">// Wrapper function to get access to currentPartialBlock from the closure</span>
<a name="l311"><span class="ln">311  </span></a>      <span class="s3">var </span><span class="s2">fn </span><span class="s1">= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">fn</span><span class="s1">;</span>
<a name="l312"><span class="ln">312  </span></a>      <span class="s2">partialBlock </span><span class="s1">= </span><span class="s2">options</span><span class="s1">.</span><span class="s2">data</span><span class="s1">[</span><span class="s0">'partial-block'</span><span class="s1">] = </span><span class="s3">function </span><span class="s2">partialBlockWrapper</span><span class="s1">(</span><span class="s2">context</span><span class="s1">) {</span>
<a name="l313"><span class="ln">313  </span></a>        <span class="s3">var </span><span class="s2">options </span><span class="s1">= </span><span class="s2">arguments</span><span class="s1">.</span><span class="s2">length </span><span class="s1">&lt;= </span><span class="s5">1 </span><span class="s1">|| </span><span class="s2">arguments</span><span class="s1">[</span><span class="s5">1</span><span class="s1">] === </span><span class="s2">undefined </span><span class="s1">? {} : </span><span class="s2">arguments</span><span class="s1">[</span><span class="s5">1</span><span class="s1">];</span>
<a name="l314"><span class="ln">314  </span></a>
<a name="l315"><span class="ln">315  </span></a>        <span class="s4">// Restore the partial-block from the closure for the execution of the block</span>
<a name="l316"><span class="ln">316  </span></a>        <span class="s4">// i.e. the part inside the block of the partial call.</span>
<a name="l317"><span class="ln">317  </span></a>        <span class="s2">options</span><span class="s1">.</span><span class="s2">data </span><span class="s1">= </span><span class="s2">_base</span><span class="s1">.</span><span class="s2">createFrame</span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">data</span><span class="s1">);</span>
<a name="l318"><span class="ln">318  </span></a>        <span class="s2">options</span><span class="s1">.</span><span class="s2">data</span><span class="s1">[</span><span class="s0">'partial-block'</span><span class="s1">] = </span><span class="s2">currentPartialBlock</span><span class="s1">;</span>
<a name="l319"><span class="ln">319  </span></a>        <span class="s3">return </span><span class="s2">fn</span><span class="s1">(</span><span class="s2">context</span><span class="s1">, </span><span class="s2">options</span><span class="s1">);</span>
<a name="l320"><span class="ln">320  </span></a>      <span class="s1">};</span>
<a name="l321"><span class="ln">321  </span></a>      <span class="s3">if </span><span class="s1">(</span><span class="s2">fn</span><span class="s1">.</span><span class="s2">partials</span><span class="s1">) {</span>
<a name="l322"><span class="ln">322  </span></a>        <span class="s2">options</span><span class="s1">.</span><span class="s2">partials </span><span class="s1">= </span><span class="s2">Utils</span><span class="s1">.</span><span class="s2">extend</span><span class="s1">({}, </span><span class="s2">options</span><span class="s1">.</span><span class="s2">partials</span><span class="s1">, </span><span class="s2">fn</span><span class="s1">.</span><span class="s2">partials</span><span class="s1">);</span>
<a name="l323"><span class="ln">323  </span></a>      <span class="s1">}</span>
<a name="l324"><span class="ln">324  </span></a>    <span class="s1">})();</span>
<a name="l325"><span class="ln">325  </span></a>  <span class="s1">}</span>
<a name="l326"><span class="ln">326  </span></a>
<a name="l327"><span class="ln">327  </span></a>  <span class="s3">if </span><span class="s1">(</span><span class="s2">partial </span><span class="s1">=== </span><span class="s2">undefined </span><span class="s1">&amp;&amp; </span><span class="s2">partialBlock</span><span class="s1">) {</span>
<a name="l328"><span class="ln">328  </span></a>    <span class="s2">partial </span><span class="s1">= </span><span class="s2">partialBlock</span><span class="s1">;</span>
<a name="l329"><span class="ln">329  </span></a>  <span class="s1">}</span>
<a name="l330"><span class="ln">330  </span></a>
<a name="l331"><span class="ln">331  </span></a>  <span class="s3">if </span><span class="s1">(</span><span class="s2">partial </span><span class="s1">=== </span><span class="s2">undefined</span><span class="s1">) {</span>
<a name="l332"><span class="ln">332  </span></a>    <span class="s3">throw new </span><span class="s2">_exception2</span><span class="s1">[</span><span class="s0">'default'</span><span class="s1">](</span><span class="s0">'The partial ' </span><span class="s1">+ </span><span class="s2">options</span><span class="s1">.</span><span class="s2">name </span><span class="s1">+ </span><span class="s0">' could not be found'</span><span class="s1">);</span>
<a name="l333"><span class="ln">333  </span></a>  <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s2">partial </span><span class="s3">instanceof </span><span class="s2">Function</span><span class="s1">) {</span>
<a name="l334"><span class="ln">334  </span></a>    <span class="s3">return </span><span class="s2">partial</span><span class="s1">(</span><span class="s2">context</span><span class="s1">, </span><span class="s2">options</span><span class="s1">);</span>
<a name="l335"><span class="ln">335  </span></a>  <span class="s1">}</span>
<a name="l336"><span class="ln">336  </span></a><span class="s1">}</span>
<a name="l337"><span class="ln">337  </span></a>
<a name="l338"><span class="ln">338  </span></a><span class="s3">function </span><span class="s2">noop</span><span class="s1">() {</span>
<a name="l339"><span class="ln">339  </span></a>  <span class="s3">return </span><span class="s0">''</span><span class="s1">;</span>
<a name="l340"><span class="ln">340  </span></a><span class="s1">}</span>
<a name="l341"><span class="ln">341  </span></a>
<a name="l342"><span class="ln">342  </span></a><span class="s3">function </span><span class="s2">initData</span><span class="s1">(</span><span class="s2">context</span><span class="s1">, </span><span class="s2">data</span><span class="s1">) {</span>
<a name="l343"><span class="ln">343  </span></a>  <span class="s3">if </span><span class="s1">(!</span><span class="s2">data </span><span class="s1">|| !(</span><span class="s0">'root' </span><span class="s3">in </span><span class="s2">data</span><span class="s1">)) {</span>
<a name="l344"><span class="ln">344  </span></a>    <span class="s2">data </span><span class="s1">= </span><span class="s2">data </span><span class="s1">? </span><span class="s2">_base</span><span class="s1">.</span><span class="s2">createFrame</span><span class="s1">(</span><span class="s2">data</span><span class="s1">) : {};</span>
<a name="l345"><span class="ln">345  </span></a>    <span class="s2">data</span><span class="s1">.</span><span class="s2">root </span><span class="s1">= </span><span class="s2">context</span><span class="s1">;</span>
<a name="l346"><span class="ln">346  </span></a>  <span class="s1">}</span>
<a name="l347"><span class="ln">347  </span></a>  <span class="s3">return </span><span class="s2">data</span><span class="s1">;</span>
<a name="l348"><span class="ln">348  </span></a><span class="s1">}</span>
<a name="l349"><span class="ln">349  </span></a>
<a name="l350"><span class="ln">350  </span></a><span class="s3">function </span><span class="s2">executeDecorators</span><span class="s1">(</span><span class="s2">fn</span><span class="s1">, </span><span class="s2">prog</span><span class="s1">, </span><span class="s2">container</span><span class="s1">, </span><span class="s2">depths</span><span class="s1">, </span><span class="s2">data</span><span class="s1">, </span><span class="s2">blockParams</span><span class="s1">) {</span>
<a name="l351"><span class="ln">351  </span></a>  <span class="s3">if </span><span class="s1">(</span><span class="s2">fn</span><span class="s1">.</span><span class="s2">decorator</span><span class="s1">) {</span>
<a name="l352"><span class="ln">352  </span></a>    <span class="s3">var </span><span class="s2">props </span><span class="s1">= {};</span>
<a name="l353"><span class="ln">353  </span></a>    <span class="s2">prog </span><span class="s1">= </span><span class="s2">fn</span><span class="s1">.</span><span class="s2">decorator</span><span class="s1">(</span><span class="s2">prog</span><span class="s1">, </span><span class="s2">props</span><span class="s1">, </span><span class="s2">container</span><span class="s1">, </span><span class="s2">depths </span><span class="s1">&amp;&amp; </span><span class="s2">depths</span><span class="s1">[</span><span class="s5">0</span><span class="s1">], </span><span class="s2">data</span><span class="s1">, </span><span class="s2">blockParams</span><span class="s1">, </span><span class="s2">depths</span><span class="s1">);</span>
<a name="l354"><span class="ln">354  </span></a>    <span class="s2">Utils</span><span class="s1">.</span><span class="s2">extend</span><span class="s1">(</span><span class="s2">prog</span><span class="s1">, </span><span class="s2">props</span><span class="s1">);</span>
<a name="l355"><span class="ln">355  </span></a>  <span class="s1">}</span>
<a name="l356"><span class="ln">356  </span></a>  <span class="s3">return </span><span class="s2">prog</span><span class="s1">;</span>
<a name="l357"><span class="ln">357  </span></a><span class="s1">}</span>
<a name="l358"><span class="ln">358  </span></a>
<a name="l359"><span class="ln">359  </span></a><span class="s3">function </span><span class="s2">wrapHelpersToPassLookupProperty</span><span class="s1">(</span><span class="s2">mergedHelpers</span><span class="s1">, </span><span class="s2">container</span><span class="s1">) {</span>
<a name="l360"><span class="ln">360  </span></a>  <span class="s2">Object</span><span class="s1">.</span><span class="s2">keys</span><span class="s1">(</span><span class="s2">mergedHelpers</span><span class="s1">).</span><span class="s2">forEach</span><span class="s1">(</span><span class="s3">function </span><span class="s1">(</span><span class="s2">helperName</span><span class="s1">) {</span>
<a name="l361"><span class="ln">361  </span></a>    <span class="s3">var </span><span class="s2">helper </span><span class="s1">= </span><span class="s2">mergedHelpers</span><span class="s1">[</span><span class="s2">helperName</span><span class="s1">];</span>
<a name="l362"><span class="ln">362  </span></a>    <span class="s2">mergedHelpers</span><span class="s1">[</span><span class="s2">helperName</span><span class="s1">] = </span><span class="s2">passLookupPropertyOption</span><span class="s1">(</span><span class="s2">helper</span><span class="s1">, </span><span class="s2">container</span><span class="s1">);</span>
<a name="l363"><span class="ln">363  </span></a>  <span class="s1">});</span>
<a name="l364"><span class="ln">364  </span></a><span class="s1">}</span>
<a name="l365"><span class="ln">365  </span></a>
<a name="l366"><span class="ln">366  </span></a><span class="s3">function </span><span class="s2">passLookupPropertyOption</span><span class="s1">(</span><span class="s2">helper</span><span class="s1">, </span><span class="s2">container</span><span class="s1">) {</span>
<a name="l367"><span class="ln">367  </span></a>  <span class="s3">var </span><span class="s2">lookupProperty </span><span class="s1">= </span><span class="s2">container</span><span class="s1">.</span><span class="s2">lookupProperty</span><span class="s1">;</span>
<a name="l368"><span class="ln">368  </span></a>  <span class="s3">return </span><span class="s2">_internalWrapHelper</span><span class="s1">.</span><span class="s2">wrapHelper</span><span class="s1">(</span><span class="s2">helper</span><span class="s1">, </span><span class="s3">function </span><span class="s1">(</span><span class="s2">options</span><span class="s1">) {</span>
<a name="l369"><span class="ln">369  </span></a>    <span class="s3">return </span><span class="s2">Utils</span><span class="s1">.</span><span class="s2">extend</span><span class="s1">({ </span><span class="s2">lookupProperty</span><span class="s1">: </span><span class="s2">lookupProperty </span><span class="s1">}, </span><span class="s2">options</span><span class="s1">);</span>
<a name="l370"><span class="ln">370  </span></a>  <span class="s1">});</span>
<a name="l371"><span class="ln">371  </span></a><span class="s1">}</span>
<a name="l372"><span class="ln">372  </span></a><span class="s4">//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2xpYi9oYW5kbGViYXJzL3J1bnRpbWUuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7cUJBQXVCLFNBQVM7O0lBQXBCLEtBQUs7O3lCQUNLLGFBQWE7Ozs7b0JBTTVCLFFBQVE7O3VCQUNtQixXQUFXOztrQ0FDbEIsdUJBQXVCOzttQ0FJM0MseUJBQXlCOztBQUV6QixTQUFTLGFBQWEsQ0FBQyxZQUFZLEVBQUU7QUFDMUMsTUFBTSxnQkFBZ0IsR0FBRyxBQUFDLFlBQVksSUFBSSxZQUFZLENBQUMsQ0FBQyxDQUFDLElBQUssQ0FBQztNQUM3RCxlQUFlLDBCQUFvQixDQUFDOztBQUV0QyxNQUNFLGdCQUFnQiwyQ0FBcUMsSUFDckQsZ0JBQWdCLDJCQUFxQixFQUNyQztBQUNBLFdBQU87R0FDUjs7QUFFRCxNQUFJLGdCQUFnQiwwQ0FBb0MsRUFBRTtBQUN4RCxRQUFNLGVBQWUsR0FBRyx1QkFBaUIsZUFBZSxDQUFDO1FBQ3ZELGdCQUFnQixHQUFHLHVCQUFpQixnQkFBZ0IsQ0FBQyxDQUFDO0FBQ3hELFVBQU0sMkJBQ0oseUZBQXlGLEdBQ3ZGLHFEQUFxRCxHQUNyRCxlQUFlLEdBQ2YsbURBQW1ELEdBQ25ELGdCQUFnQixHQUNoQixJQUFJLENBQ1AsQ0FBQztHQUNILE1BQU07O0FBRUwsVUFBTSwyQkFDSix3RkFBd0YsR0FDdEYsaURBQWlELEdBQ2pELFlBQVksQ0FBQyxDQUFDLENBQUMsR0FDZixJQUFJLENBQ1AsQ0FBQztHQUNIO0NBQ0Y7O0FBRU0sU0FBUyxRQUFRLENBQUMsWUFBWSxFQUFFLEdBQUcsRUFBRTs7QUFFMUMsTUFBSSxDQUFDLEdBQUcsRUFBRTtBQUNSLFVBQU0sMkJBQWMsbUNBQW1DLENBQUMsQ0FBQztHQUMxRDtBQUNELE1BQUksQ0FBQyxZQUFZLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFO0FBQ3ZDLFVBQU0sMkJBQWMsMkJBQTJCLEdBQUcsT0FBTyxZQUFZLENBQUMsQ0FBQztH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QUFDbkMsV0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUUsY0FBYyxFQUFkLGNBQWMsRUFBRSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0dBQ2xELENBQUMsQ0FBQztDQUNKIiwiZmlsZSI6InJ1bnRpbWUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBVdGlscyBmcm9tICcuL3V0aWxzJztcbmltcG9ydCBFeGNlcHRpb24gZnJvbSAnLi9leGNlcHRpb24nO1xuaW1wb3J0IHtcbiAgQ09NUElMRVJfUkVWSVNJT04sXG4gIGNyZWF0ZUZyYW1lLFxuICBMQVNUX0NPTVBBVElCTEVfQ09NUElMRVJfUkVWSVNJT04sXG4gIFJFVklTSU9OX0NIQU5HRVNcbn0gZnJvbSAnLi9iYXNlJztcbmltcG9ydCB7IG1vdmVIZWxwZXJUb0hvb2tzIH0gZnJvbSAnLi9oZWxwZXJzJztcbmltcG9ydCB7IHdyYXBIZWxwZXIgfSBmcm9tICcuL2ludGVybmFsL3dyYXBIZWxwZXInO1xuaW1wb3J0IHtcbiAgY3JlYXRlUHJvdG9BY2Nlc3NDb250cm9sLFxuICByZXN1bHRJc0FsbG93ZWRcbn0gZnJvbSAnLi9pbnRlcm5hbC9wcm90by1hY2Nlc3MnO1xuXG5leHBvcnQgZnVuY3Rpb24gY2hlY2tSZXZpc2lvbihjb21waWxlckluZm8pIHtcbiAgY29uc3QgY29tcGlsZXJSZXZpc2lvbiA9IChjb21waWxlckluZm8gJiYgY29tcGlsZXJJbmZvWzBdKSB8fCAxLFxuICAgIGN1cnJlbnRSZXZpc2lvbiA9IENPTVBJTEVSX1JFVklTSU9OO1xuXG4gIGlmIChcbiAgICBjb21waWxlclJldmlzaW9uID49IExBU1RfQ09NUEFUSUJMRV9DT01QSUxFUl9SRVZJU0lPTiAmJlxuICAgIGNvbXBpbGVyUmV2aXNpb24gPD0gQ09NUElMRVJfUkVWSVNJT05cbiAgKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGNvbXBpbGVyUmV2aXNpb24gPCBMQVNUX0NPTVBBVElCTEVfQ09NUElMRVJfUkVWSVNJT04pIHtcbiAgICBjb25zdCBydW50aW1lVmVyc2lvbnMgPSBSRVZJU0lPTl9DSEFOR0VTW2N1cnJlbnRSZXZpc2lvbl0sXG4gICAgICBjb21waWxlclZlcnNpb25zID0gUkVWSVNJT05fQ0hBTkdFU1tjb21waWxlclJldmlzaW9uXTtcbiAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKFxuICAgICAgJ1RlbXBsYXRlIHdhcyBwcmVjb21waWxlZCB3aXRoIGFuIG9sZGVyIHZlcnNpb24gb2YgSGFuZGxlYmFycyB0aGFuIHRoZSBjdXJyZW50IHJ1bnRpbWUuICcgK1xuICAgICAgICAnUGxlYXNlIHVwZGF0ZSB5b3VyIHByZWNvbXBpbGVyIHRvIGEgbmV3ZXIgdmVyc2lvbiAoJyArXG4gICAgICAgIHJ1bnRpbWVWZXJzaW9ucyArXG4gICAgICAgICcpIG9yIGRvd25ncmFkZSB5b3VyIHJ1bnRpbWUgdG8gYW4gb2xkZXIgdmVyc2lvbiAoJyArXG4gICAgICAgIGNvbXBpbGVyVmVyc2lvbnMgK1xuICAgICAgICAnKS4nXG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICAvLyBVc2UgdGhlIGVtYmVkZGVkIHZlcnNpb24gaW5mbyBzaW5jZSB0aGUgcnVudGltZSBkb2Vzbid0IGtub3cgYWJvdXQgdGhpcyByZXZpc2lvbiB5ZXRcbiAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKFxuICAgICAgJ1RlbXBsYXRlIHdhcyBwcmVjb21waWxlZCB3aXRoIGEgbmV3ZXIgdmVyc2lvbiBvZiBIYW5kbGViYXJzIHRoYW4gdGhlIGN1cnJlbnQgcnVudGltZS4gJyArXG4gICAgICAgICdQbGVhc2UgdXBkYXRlIHlvdXIgcnVudGltZSB0byBhIG5ld2VyIHZlcnNpb24gKCcgK1xuICAgICAgICBjb21waWxlckluZm9bMV0gK1xuICAgICAgICAnKS4nXG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gdGVtcGxhdGUodGVtcGxhdGVTcGVjLCBlbnYpIHtcbiAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgaWYgKCFlbnYpIHtcbiAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCdObyBlbnZpcm9ubWVudCBwYXNzZWQgdG8gdGVtcGxhdGUnKTtcbiAgfVxuICBpZiAoIXRlbXBsYXRlU3BlYyB8fCAhdGVtcGxhdGVTcGVjLm1haW4pIHtcbiAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKCdVbmtub3duIHRlbXBsYXRlIG9iamVjdDogJyArIHR5cGVvZiB0ZW1wbGF0ZVNwZWMpO1xuICB9XG5cbiAgdGVtcGxhdGVTcGVjLm1haW4uZGVjb3JhdG9yID0gdGVtcGxhdGVTcGVjLm1haW5fZDtcblxuICAvLyBOb3RlOiBVc2luZyBlbnYuVk0gcmVmZXJlbmNlcyByYXRoZXIgdGhhbiBsb2NhbCB2YXIgcmVmZXJlbmNlcyB0aHJvdWdob3V0IHRoaXMgc2VjdGlvbiB0byBhbGxvd1xuICAvLyBmb3IgZXh0ZXJuYWwgdXNlcnMgdG8gb3ZlcnJpZGUgdGhlc2UgYXMgcHNldWRvLXN1cHBvcnRlZCBBUElzLlxuICBlbnYuVk0uY2hlY2tSZXZpc2lvbih0ZW1wbGF0ZVNwZWMuY29tcGlsZXIpO1xuXG4gIC8vIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGZvciBwcmVjb21waWxlZCB0ZW1wbGF0ZXMgd2l0aCBjb21waWxlci12ZXJzaW9uIDcgKDw0LjMuMClcbiAgY29uc3QgdGVtcGxhdGVXYXNQcmVjb21waWxlZFdpdGhDb21waWxlclY3ID1cbiAgICB0ZW1wbGF0ZVNwZWMuY29tcGlsZXIgJiYgdGVtcGxhdGVTcGVjLmNvbXBpbGVyWzBdID09PSA3O1xuXG4gIGZ1bmN0aW9uIGludm9rZVBhcnRpYWxXcmFwcGVyKHBhcnRpYWwsIGNvbnRleHQsIG9wdGlvbnMpIHtcbiAgICBpZiAob3B0aW9ucy5oYXNoKSB7XG4gICAgICBjb250ZXh0ID0gVXRpbHMuZXh0ZW5kKHt9LCBjb250ZXh0LCBvcHRpb25zLmhhc2gpO1xuICAgICAgaWYgKG9wdGlvbnMuaWRzKSB7XG4gICAgICAgIG9wdGlvbnMuaWRzWzBdID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcGFydGlhbCA9IGVudi5WTS5yZXNvbHZlUGFydGlhbC5jYWxsKHRoaXMsIHBhcnRpYWwsIGNvbnRleHQsIG9wdGlvbnMpO1xuXG4gICAgbGV0IGV4dGVuZGVkT3B0aW9ucyA9IFV0aWxzLmV4dGVuZCh7fSwgb3B0aW9ucywge1xuICAgICAgaG9va3M6IHRoaXMuaG9va3MsXG4gICAgICBwcm90b0FjY2Vzc0NvbnRyb2w6IHRoaXMucHJvdG9BY2Nlc3NDb250cm9sXG4gICAgfSk7XG5cbiAgICBsZXQgcmVzdWx0ID0gZW52LlZNLmludm9rZVBhcnRpYWwuY2FsbChcbiAgICAgIHRoaXMsXG4gICAgICBwYXJ0aWFsLFxuICAgICAgY29udGV4dCxcbiAgICAgIGV4dGVuZGVkT3B0aW9uc1xuICAgICk7XG5cbiAgICBpZiAocmVzdWx0ID09IG51bGwgJiYgZW52LmNvbXBpbGUpIHtcbiAgICAgIG9wdGlvbnMucGFydGlhbHNbb3B0aW9ucy5uYW1lXSA9IGVudi5jb21waWxlKFxuICAgICAgICBwYXJ0aWFsLFxuICAgICAgICB0ZW1wbGF0ZVNwZWMuY29tcGlsZXJPcHRpb25zLFxuICAgICAgICBlbnZcbiAgICAgICk7XG4gICAgICByZXN1bHQgPSBvcHRpb25zLnBhcnRpYWxzW29wdGlvbnMubmFtZV0oY29udGV4dCwgZXh0ZW5kZWRPcHRpb25zKTtcbiAgICB9XG4gICAgaWYgKHJlc3VsdCAhPSBudWxsKSB7XG4gICAgICBpZiAob3B0aW9ucy5pbmRlbnQpIHtcbiAgICAgICAgbGV0IGxpbmVzID0gcmVzdWx0LnNwbGl0KCdcXG4nKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBsaW5lcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICBpZiAoIWxpbmVzW2ldICYmIGkgKyAxID09PSBsKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBsaW5lc1tpXSA9IG9wdGlvbnMuaW5kZW50ICsgbGluZXNbaV07XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0ID0gbGluZXMuam9pbignXFxuJyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXhjZXB0aW9uKFxuICAgICAgICAnVGhlIHBhcnRpYWwgJyArXG4gICAgICAgICAgb3B0aW9ucy5uYW1lICtcbiAgICAgICAgICAnIGNvdWxkIG5vdCBiZSBjb21waWxlZCB3aGVuIHJ1bm5pbmcgaW4gcnVudGltZS1vbmx5IG1vZGUnXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8vIEp1c3QgYWRkIHdhdGVyXG4gIGxldCBjb250YWluZXIgPSB7XG4gICAgc3RyaWN0OiBmdW5jdGlvbihvYmosIG5hbWUsIGxvYykge1xuICAgICAgaWYgKCFvYmogfHwgIShuYW1lIGluIG9iaikpIHtcbiAgICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbignXCInICsgbmFtZSArICdcIiBub3QgZGVmaW5lZCBpbiAnICsgb2JqLCB7XG4gICAgICAgICAgbG9jOiBsb2NcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gY29udGFpbmVyLmxvb2t1cFByb3BlcnR5KG9iaiwgbmFtZSk7XG4gICAgfSxcbiAgICBsb29rdXBQcm9wZXJ0eTogZnVuY3Rpb24ocGFyZW50LCBwcm9wZXJ0eU5hbWUpIHtcbiAgICAgIGxldCByZXN1bHQgPSBwYXJlbnRbcHJvcGVydHlOYW1lXTtcbiAgICAgIGlmIChyZXN1bHQgPT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChwYXJlbnQsIHByb3BlcnR5TmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlc3VsdElzQWxsb3dlZChyZXN1bHQsIGNvbnRhaW5lci5wcm90b0FjY2Vzc0NvbnRyb2wsIHByb3BlcnR5TmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfSxcbiAgICBsb29rdXA6IGZ1bmN0aW9uKGRlcHRocywgbmFtZSkge1xuICAgICAgY29uc3QgbGVuID0gZGVwdGhzLmxlbmd0aDtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IGRlcHRoc1tpXSAmJiBjb250YWluZXIubG9va3VwUHJvcGVydHkoZGVwdGhzW2ldLCBuYW1lKTtcbiAgICAgICAgaWYgKHJlc3VsdCAhPSBudWxsKSB7XG4gICAgICAgICAgcmV0dXJuIGRlcHRoc1tpXVtuYW1lXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgbGFtYmRhOiBmdW5jdGlvbihjdXJyZW50LCBjb250ZXh0KSB7XG4gICAgICByZXR1cm4gdHlwZW9mIGN1cnJlbnQgPT09ICdmdW5jdGlvbicgPyBjdXJyZW50LmNhbGwoY29udGV4dCkgOiBjdXJyZW50O1xuICAgIH0sXG5cbiAgICBlc2NhcGVFeHByZXNzaW9uOiBVdGlscy5lc2NhcGVFeHByZXNzaW9uLFxuICAgIGludm9rZVBhcnRpYWw6IGludm9rZVBhcnRpYWxXcmFwcGVyLFxuXG4gICAgZm46IGZ1bmN0aW9uKGkpIHtcbiAgICAgIGxldCByZXQgPSB0ZW1wbGF0ZVNwZWNbaV07XG4gICAgICByZXQuZGVjb3JhdG9yID0gdGVtcGxhdGVTcGVjW2kgKyAnX2QnXTtcbiAgICAgIHJldHVybiByZXQ7XG4gICAgfSxcblxuICAgIHByb2dyYW1zOiBbXSxcbiAgICBwcm9ncmFtOiBmdW5jdGlvbihpLCBkYXRhLCBkZWNsYXJlZEJsb2NrUGFyYW1zLCBibG9ja1BhcmFtcywgZGVwdGhzKSB7XG4gICAgICBsZXQgcHJvZ3JhbVdyYXBwZXIgPSB0aGlzLnByb2dyYW1zW2ldLFxuICAgICAgICBmbiA9IHRoaXMuZm4oaSk7XG4gICAgICBpZiAoZGF0YSB8fCBkZXB0aHMgfHwgYmxvY2tQYXJhbXMgfHwgZGVjbGFyZWRCbG9ja1BhcmFtcykge1xuICAgICAgICBwcm9ncmFtV3JhcHBlciA9IHdyYXBQcm9ncmFtKFxuICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgaSxcbiAgICAgICAgICBmbixcbiAgICAgICAgICBkYXRhLFxuICAgICAgICAgIGRlY2xhcmVkQmxvY2tQYXJhbXMsXG4gICAgICAgICAgYmxvY2tQYXJhbXMsXG4gICAgICAgICAgZGVwdGhzXG4gICAgICAgICk7XG4gICAgICB9IGVsc2UgaWYgKCFwcm9ncmFtV3JhcHBlcikge1xuICAgICAgICBwcm9ncmFtV3JhcHBlciA9IHRoaXMucHJvZ3JhbXNbaV0gPSB3cmFwUHJvZ3JhbSh0aGlzLCBpLCBmbik7XG4gICAgICB9XG4gICAgICByZXR1cm4gcHJvZ3JhbVdyYXBwZXI7XG4gICAgfSxcblxuICAgIGRhdGE6IGZ1bmN0aW9uKHZhbHVlLCBkZXB0aCkge1xuICAgICAgd2hpbGUgKHZhbHVlICYmIGRlcHRoLS0pIHtcbiAgICAgICAgdmFsdWUgPSB2YWx1ZS5fcGFyZW50O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHZhbHVlO1xuICAgIH0sXG4gICAgbWVyZ2VJZk5lZWRlZDogZnVuY3Rpb24ocGFyYW0sIGNvbW1vbikge1xuICAgICAgbGV0IG9iaiA9IHBhcmFtIHx8IGNvbW1vbjtcblxuICAgICAgaWYgKHBhcmFtICYmIGNvbW1vbiAmJiBwYXJhbSAhPT0gY29tbW9uKSB7XG4gICAgICAgIG9iaiA9IFV0aWxzLmV4dGVuZCh7fSwgY29tbW9uLCBwYXJhbSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBvYmo7XG4gICAgfSxcbiAgICAvLyBBbiBlbXB0eSBvYmplY3QgdG8gdXNlIGFzIHJlcGxhY2VtZW50IGZvciBudWxsLWNvbnRleHRzXG4gICAgbnVsbENvbnRleHQ6IE9iamVjdC5zZWFsKHt9KSxcblxuICAgIG5vb3A6IGVudi5WTS5ub29wLFxuICAgIGNvbXBpbGVySW5mbzogdGVtcGxhdGVTcGVjLmNvbXBpbGVyXG4gIH07XG5cbiAgZnVuY3Rpb24gcmV0KGNvbnRleHQsIG9wdGlvbnMgPSB7fSkge1xuICAgIGxldCBkYXRhID0gb3B0aW9ucy5kYXRhO1xuXG4gICAgcmV0Ll9zZXR1cChvcHRpb25zKTtcbiAgICBpZiAoIW9wdGlvbnMucGFydGlhbCAmJiB0ZW1wbGF0ZVNwZWMudXNlRGF0YSkge1xuICAgICAgZGF0YSA9IGluaXREYXRhKGNvbnRleHQsIGRhdGEpO1xuICAgIH1cbiAgICBsZXQgZGVwdGhzLFxuICAgICAgYmxvY2tQYXJhbXMgPSB0ZW1wbGF0ZVNwZWMudXNlQmxvY2tQYXJhbXMgPyBbXSA6IHVuZGVmaW5lZDtcbiAgICBpZiAodGVtcGxhdGVTcGVjLnVzZURlcHRocykge1xuICAgICAgaWYgKG9wdGlvbnMuZGVwdGhzKSB7XG4gICAgICAgIGRlcHRocyA9XG4gICAgICAgICAgY29udGV4dCAhPSBvcHRpb25zLmRlcHRoc1swXVxuICAgICAgICAgICAgPyBbY29udGV4dF0uY29uY2F0KG9wdGlvbnMuZGVwdGhzKVxuICAgICAgICAgICAgOiBvcHRpb25zLmRlcHRocztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRlcHRocyA9IFtjb250ZXh0XTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBtYWluKGNvbnRleHQgLyosIG9wdGlvbnMqLykge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgJycgK1xuICAgICAgICB0ZW1wbGF0ZVNwZWMubWFpbihcbiAgICAgICAgICBjb250YWluZXIsXG4gICAgICAgICAgY29udGV4dCxcbiAgICAgICAgICBjb250YWluZXIuaGVscGVycyxcbiAgICAgICAgICBjb250YWluZXIucGFydGlhbHMsXG4gICAgICAgICAgZGF0YSxcbiAgICAgICAgICBibG9ja1BhcmFtcyxcbiAgICAgICAgICBkZXB0aHNcbiAgICAgICAgKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBtYWluID0gZXhlY3V0ZURlY29yYXRvcnMoXG4gICAgICB0ZW1wbGF0ZVNwZWMubWFpbixcbiAgICAgIG1haW4sXG4gICAgICBjb250YWluZXIsXG4gICAgICBvcHRpb25zLmRlcHRocyB8fCBbXSxcbiAgICAgIGRhdGEsXG4gICAgICBibG9ja1BhcmFtc1xuICAgICk7XG4gICAgcmV0dXJuIG1haW4oY29udGV4dCwgb3B0aW9ucyk7XG4gIH1cblxuICByZXQuaXNUb3AgPSB0cnVlO1xuXG4gIHJldC5fc2V0dXAgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgaWYgKCFvcHRpb25zLnBhcnRpYWwpIHtcbiAgICAgIGxldCBtZXJnZWRIZWxwZXJzID0gVXRpbHMuZXh0ZW5kKHt9LCBlbnYuaGVscGVycywgb3B0aW9ucy5oZWxwZXJzKTtcbiAgICAgIHdyYXBIZWxwZXJzVG9QYXNzTG9va3VwUHJvcGVydHkobWVyZ2VkSGVscGVycywgY29udGFpbmVyKTtcbiAgICAgIGNvbnRhaW5lci5oZWxwZXJzID0gbWVyZ2VkSGVscGVycztcblxuICAgICAgaWYgKHRlbXBsYXRlU3BlYy51c2VQYXJ0aWFsKSB7XG4gICAgICAgIC8vIFVzZSBtZXJnZUlmTmVlZGVkIGhlcmUgdG8gcHJldmVudCBjb21waWxpbmcgZ2xvYmFsIHBhcnRpYWxzIG11bHRpcGxlIHRpbWVzXG4gICAgICAgIGNvbnRhaW5lci5wYXJ0aWFscyA9IGNvbnRhaW5lci5tZXJnZUlmTmVlZGVkKFxuICAgICAgICAgIG9wdGlvbnMucGFydGlhbHMsXG4gICAgICAgICAgZW52LnBhcnRpYWxzXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICBpZiAodGVtcGxhdGVTcGVjLnVzZVBhcnRpYWwgfHwgdGVtcGxhdGVTcGVjLnVzZURlY29yYXRvcnMpIHtcbiAgICAgICAgY29udGFpbmVyLmRlY29yYXRvcnMgPSBVdGlscy5leHRlbmQoXG4gICAgICAgICAge30sXG4gICAgICAgICAgZW52LmRlY29yYXRvcnMsXG4gICAgICAgICAgb3B0aW9ucy5kZWNvcmF0b3JzXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnRhaW5lci5ob29rcyA9IHt9O1xuICAgICAgY29udGFpbmVyLnByb3RvQWNjZXNzQ29udHJvbCA9IGNyZWF0ZVByb3RvQWNjZXNzQ29udHJvbChvcHRpb25zKTtcblxuICAgICAgbGV0IGtlZXBIZWxwZXJJbkhlbHBlcnMgPVxuICAgICAgICBvcHRpb25zLmFsbG93Q2FsbHNUb0hlbHBlck1pc3NpbmcgfHxcbiAgICAgICAgdGVtcGxhdGVXYXNQcmVjb21waWxlZFdpdGhDb21waWxlclY3O1xuICAgICAgbW92ZUhlbHBlclRvSG9va3MoY29udGFpbmVyLCAnaGVscGVyTWlzc2luZycsIGtlZXBIZWxwZXJJbkhlbHBlcnMpO1xuICAgICAgbW92ZUhlbHBlclRvSG9va3MoY29udGFpbmVyLCAnYmxvY2tIZWxwZXJNaXNzaW5nJywga2VlcEhlbHBlckluSGVscGVycyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnRhaW5lci5wcm90b0FjY2Vzc0NvbnRyb2wgPSBvcHRpb25zLnByb3RvQWNjZXNzQ29udHJvbDsgLy8gaW50ZXJuYWwgb3B0aW9uXG4gICAgICBjb250YWluZXIuaGVscGVycyA9IG9wdGlvbnMuaGVscGVycztcbiAgICAgIGNvbnRhaW5lci5wYXJ0aWFscyA9IG9wdGlvbnMucGFydGlhbHM7XG4gICAgICBjb250YWluZXIuZGVjb3JhdG9ycyA9IG9wdGlvbnMuZGVjb3JhdG9ycztcbiAgICAgIGNvbnRhaW5lci5ob29rcyA9IG9wdGlvbnMuaG9va3M7XG4gICAgfVxuICB9O1xuXG4gIHJldC5fY2hpbGQgPSBmdW5jdGlvbihpLCBkYXRhLCBibG9ja1BhcmFtcywgZGVwdGhzKSB7XG4gICAgaWYgKHRlbXBsYXRlU3BlYy51c2VCbG9ja1BhcmFtcyAmJiAhYmxvY2tQYXJhbXMpIHtcbiAgICAgIHRocm93IG5ldyBFeGNlcHRpb24oJ211c3QgcGFzcyBibG9jayBwYXJhbXMnKTtcbiAgICB9XG4gICAgaWYgKHRlbXBsYXRlU3BlYy51c2VEZXB0aHMgJiYgIWRlcHRocykge1xuICAgICAgdGhyb3cgbmV3IEV4Y2VwdGlvbignbXVzdCBwYXNzIHBhcmVudCBkZXB0aHMnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gd3JhcFByb2dyYW0oXG4gICAgICBjb250YWluZXIsXG4gICAgICBpLFxuICAgICAgdGVtcGxhdGVTcGVjW2ldLFxuICAgICAgZGF0YSxcbiAgICAgIDAsXG4gICAgICBibG9ja1BhcmFtcyxcbiAgICAgIGRlcHRoc1xuICAgICk7XG4gIH07XG4gIHJldHVybiByZXQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3cmFwUHJvZ3JhbShcbiAgY29udGFpbmVyLFxuICBpLFxuICBmbixcbiAgZGF0YSxcbiAgZGVjbGFyZWRCbG9ja1BhcmFtcyxcbiAgYmxvY2tQYXJhbXMsXG4gIGRlcHRoc1xuKSB7XG4gIGZ1bmN0aW9uIHByb2coY29udGV4dCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgbGV0IGN1cnJlbnREZXB0aHMgPSBkZXB0aHM7XG4gICAgaWYgKFxuICAgICAgZGVwdGhzICYmXG4gICAgICBjb250ZXh0ICE9IGRlcHRoc1swXSAmJlxuICAgICAgIShjb250ZXh0ID09PSBjb250YWluZXIubnVsbENvbnRleHQgJiYgZGVwdGhzWzBdID09PSBudWxsKVxuICAgICkge1xuICAgICAgY3VycmVudERlcHRocyA9IFtjb250ZXh0XS5jb25jYXQoZGVwdGhzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZm4oXG4gICAgICBjb250YWluZXIsXG4gICAgICBjb250ZXh0LFxuICAgICAgY29udGFpbmVyLmhlbHBlcnMsXG4gICAgICBjb250YWluZXIucGFydGlhbHMsXG4gICAgICBvcHRpb25zLmRhdGEgfHwgZGF0YSxcbiAgICAgIGJsb2NrUGFyYW1zICYmIFtvcHRpb25zLmJsb2NrUGFyYW1zXS5jb25jYXQoYmxvY2tQYXJhbXMpLFxuICAgICAgY3VycmVudERlcHRoc1xuICAgICk7XG4gIH1cblxuICBwcm9nID0gZXhlY3V0ZURlY29yYXRvcnMoZm4sIHByb2csIGNvbnRhaW5lciwgZGVwdGhzLCBkYXRhLCBibG9ja1BhcmFtcyk7XG5cbiAgcHJvZy5wcm9ncmFtID0gaTtcbiAgcHJvZy5kZXB0aCA9IGRlcHRocyA/IGRlcHRocy5sZW5ndGggOiAwO1xuICBwcm9nLmJsb2NrUGFyYW1zID0gZGVjbGFyZWRCbG9ja1BhcmFtcyB8fCAwO1xuICByZXR1cm4gcHJvZztcbn1cblxuLyoqXG4gKiBUaGlzIGlzIGN1cnJlbnRseSBwYXJ0IG9mIHRoZSBvZmZpY2lhbCBBUEksIHRoZXJlZm9yZSBpbXBsZW1lbnRhdGlvbiBkZXRhaWxzIHNob3VsZCBub3QgYmUgY2hhbmdlZC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVQYXJ0aWFsKHBhcnRpYWwsIGNvbnRleHQsIG9wdGlvbnMpIHtcbiAgaWYgKCFwYXJ0aWFsKSB7XG4gICAgaWYgKG9wdGlvbnMubmFtZSA9PT0gJ0BwYXJ0aWFsLWJsb2NrJykge1xuICAgICAgcGFydGlhbCA9IG9wdGlvbnMuZGF0YVsncGFydGlhbC1ibG9jayddO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXJ0aWFsID0gb3B0aW9ucy5wYXJ0aWFsc1tvcHRpb25zLm5hbWVdO1xuICAgIH1cbiAgfSBlbHNlIGlmICghcGFydGlhbC5jYWxsICYmICFvcHRpb25zLm5hbWUpIHtcbiAgICAvLyBUaGlzIGlzIGEgZHluYW1pYyBwYXJ0aWFsIHRoYXQgcmV0dXJuZWQgYSBzdHJpbmdcbiAgICBvcHRpb25zLm5hbWUgPSBwYXJ0aWFsO1xuICAgIHBhcnRpYWwgPSBvcHRpb25zLnBhcnRpYWxzW3BhcnRpYWxdO1xuICB9XG4gIHJldHVybiBwYXJ0aWFsO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW52b2tlUGFydGlhbChwYXJ0aWFsLCBjb250ZXh0LCBvcHRpb25zKSB7XG4gIC8vIFVzZSB0aGUgY3VycmVudCBjbG9zdXJlIGNvbnRleHQgdG8gc2F2ZSB0aGUgcGFydGlhbC1ibG9jayBpZiB0aGlzIHBhcnRpYWxcbiAgY29uc3QgY3VycmVudFBhcnRpYWxCbG9jayA9IG9wdGlvbnMuZGF0YSAmJiBvcHRpb25zLmRhdGFbJ3BhcnRpYWwtYmxvY2snXTtcbiAgb3B0aW9ucy5wYXJ0aWFsID0gdHJ1ZTtcbiAgaWYgKG9wdGlvbnMuaWRzKSB7XG4gICAgb3B0aW9ucy5kYXRhLmNvbnRleHRQYXRoID0gb3B0aW9ucy5pZHNbMF0gfHwgb3B0aW9ucy5kYXRhLmNvbnRleHRQYXRoO1xuICB9XG5cbiAgbGV0IHBhcnRpYWxCbG9jaztcbiAgaWYgKG9wdGlvbnMuZm4gJiYgb3B0aW9ucy5mbiAhPT0gbm9vcCkge1xuICAgIG9wdGlvbnMuZGF0YSA9IGNyZWF0ZUZyYW1lKG9wdGlvbnMuZGF0YSk7XG4gICAgLy8gV3JhcHBlciBmdW5jdGlvbiB0byBnZXQgYWNjZXNzIHRvIGN1cnJlbnRQYXJ0aWFsQmxvY2sgZnJvbSB0aGUgY2xvc3VyZVxuICAgIGxldCBmbiA9IG9wdGlvbnMuZm47XG4gICAgcGFydGlhbEJsb2NrID0gb3B0aW9ucy5kYXRhWydwYXJ0aWFsLWJsb2NrJ10gPSBmdW5jdGlvbiBwYXJ0aWFsQmxvY2tXcmFwcGVyKFxuICAgICAgY29udGV4dCxcbiAgICAgIG9wdGlvbnMgPSB7fVxuICAgICkge1xuICAgICAgLy8gUmVzdG9yZSB0aGUgcGFydGlhbC1ibG9jayBmcm9tIHRoZSBjbG9zdXJlIGZvciB0aGUgZXhlY3V0aW9uIG9mIHRoZSBibG9ja1xuICAgICAgLy8gaS5lLiB0aGUgcGFydCBpbnNpZGUgdGhlIGJsb2NrIG9mIHRoZSBwYXJ0aWFsIGNhbGwuXG4gICAgICBvcHRpb25zLmRhdGEgPSBjcmVhdGVGcmFtZShvcHRpb25zLmRhdGEpO1xuICAgICAgb3B0aW9ucy5kYXRhWydwYXJ0aWFsLWJsb2NrJ10gPSBjdXJyZW50UGFydGlhbEJsb2NrO1xuICAgICAgcmV0dXJuIGZuKGNvbnRleHQsIG9wdGlvbnMpO1xuICAgIH07XG4gICAgaWYgKGZuLnBhcnRpYWxzKSB7XG4gICAgICBvcHRpb25zLnBhcnRpYWxzID0gVXRpbHMuZXh0ZW5kKHt9LCBvcHRpb25zLnBhcnRpYWxzLCBmbi5wYXJ0aWFscyk7XG4gICAgfVxuICB9XG5cbiAgaWYgKHBhcnRpYWwgPT09IHVuZGVmaW5lZCAmJiBwYXJ0aWFsQmxvY2spIHtcbiAgICBwYXJ0aWFsID0gcGFydGlhbEJsb2NrO1xuICB9XG5cbiAgaWYgKHBhcnRpYWwgPT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBFeGNlcHRpb24oJ1RoZSBwYXJ0aWFsICcgKyBvcHRpb25zLm5hbWUgKyAnIGNvdWxkIG5vdCBiZSBmb3VuZCcpO1xuICB9IGVsc2UgaWYgKHBhcnRpYWwgaW5zdGFuY2VvZiBGdW5jdGlvbikge1xuICAgIHJldHVybiBwYXJ0aWFsKGNvbnRleHQsIG9wdGlvbnMpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub29wKCkge1xuICByZXR1cm4gJyc7XG59XG5cbmZ1bmN0aW9uIGluaXREYXRhKGNvbnRleHQsIGRhdGEpIHtcbiAgaWYgKCFkYXRhIHx8ICEoJ3Jvb3QnIGluIGRhdGEpKSB7XG4gICAgZGF0YSA9IGRhdGEgPyBjcmVhdGVGcmFtZShkYXRhKSA6IHt9O1xuICAgIGRhdGEucm9vdCA9IGNvbnRleHQ7XG4gIH1cbiAgcmV0dXJuIGRhdGE7XG59XG5cbmZ1bmN0aW9uIGV4ZWN1dGVEZWNvcmF0b3JzKGZuLCBwcm9nLCBjb250YWluZXIsIGRlcHRocywgZGF0YSwgYmxvY2tQYXJhbXMpIHtcbiAgaWYgKGZuLmRlY29yYXRvcikge1xuICAgIGxldCBwcm9wcyA9IHt9O1xuICAgIHByb2cgPSBmbi5kZWNvcmF0b3IoXG4gICAgICBwcm9nLFxuICAgICAgcHJvcHMsXG4gICAgICBjb250YWluZXIsXG4gICAgICBkZXB0aHMgJiYgZGVwdGhzWzBdLFxuICAgICAgZGF0YSxcbiAgICAgIGJsb2NrUGFyYW1zLFxuICAgICAgZGVwdGhzXG4gICAgKTtcbiAgICBVdGlscy5leHRlbmQocHJvZywgcHJvcHMpO1xuICB9XG4gIHJldHVybiBwcm9nO1xufVxuXG5mdW5jdGlvbiB3cmFwSGVscGVyc1RvUGFzc0xvb2t1cFByb3BlcnR5KG1lcmdlZEhlbHBlcnMsIGNvbnRhaW5lcikge1xuICBPYmplY3Qua2V5cyhtZXJnZWRIZWxwZXJzKS5mb3JFYWNoKGhlbHBlck5hbWUgPT4ge1xuICAgIGxldCBoZWxwZXIgPSBtZXJnZWRIZWxwZXJzW2hlbHBlck5hbWVdO1xuICAgIG1lcmdlZEhlbHBlcnNbaGVscGVyTmFtZV0gPSBwYXNzTG9va3VwUHJvcGVydHlPcHRpb24oaGVscGVyLCBjb250YWluZXIpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcGFzc0xvb2t1cFByb3BlcnR5T3B0aW9uKGhlbHBlciwgY29udGFpbmVyKSB7XG4gIGNvbnN0IGxvb2t1cFByb3BlcnR5ID0gY29udGFpbmVyLmxvb2t1cFByb3BlcnR5O1xuICByZXR1cm4gd3JhcEhlbHBlcihoZWxwZXIsIG9wdGlvbnMgPT4ge1xuICAgIHJldHVybiBVdGlscy5leHRlbmQoeyBsb29rdXBQcm9wZXJ0eSB9LCBvcHRpb25zKTtcbiAgfSk7XG59XG4iXX0=</span>
<a name="l373"><span class="ln">373  </span></a></pre>
</body>
</html>